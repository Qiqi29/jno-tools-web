import{g as J,_ as w,h as S,o as h,c as f,a as n,n as F,i as y,b as g,t as r,u as p,e as L,j as q,k as X,d as G,l as M,m as K,p as Q,v as Y,q as Z,s as tt,F as et,x as ot,w as B,y as st}from"./index-DxQsIYMw.js";import{t as nt}from"./Topbar-CPZzBfPl.js";import{i as U}from"./Icon-AMVm_MOg.js";function R(e){let t=e;typeof e=="string"&&(t=e.split(",").map(s=>parseInt(s,10)));const l=s=>{const o=s.toString(16);return o.length===1?"0"+o:o};return"#"+l(t[0])+l(t[1])+l(t[2])}function lt(e,t,l,s,o){const i=(e-t)/(l-t),c=s+i*(o-s);return Math.min(o,Math.max(s,c))}const E={imageData:null,newImageData:null,resultCode:null,imageWidth:80,colorNum:3,colorDetail:100,transMode:0,transModeList:["关闭","自动","指定颜色"],transColor:0,imageColors:[],activeColor:15,colorList:[]},D=J("label_date",{state:()=>({...E}),actions:{reset(){Object.assign(this,E),this.colorList=[]}}}),x=D(),at=["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0A0A0A","#0B0B0B","#0C0C0C","#0D0D0D","#0E0E0E","#0F0F0F","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818"];function it(e,t){const l=document.createElement("canvas"),s=l.getContext("2d"),o=t/e.width*e.height;return l.width=t,l.height=o,s.drawImage(e,0,0,t,o),l}function ct(e){const t=it(e,x.imageWidth),l=t.getContext("2d",{willReadFrequently:!0}),s=l.getImageData(0,0,t.width,t.height),o=s.data,i={};for(let a=0;a<o.length;a+=4){const _=o[a],m=o[a+1],d=o[a+2];if(o[a+3]===0)continue;const b=`${_},${m},${d}`;i[b]?i[b]++:i[b]=1}const u=Object.entries(i).sort((a,_)=>_[1]-a[1]).slice(0,x.colorNum).map(a=>a[0]);x.imageColors=u,dt(u);for(let a=0;a<o.length;a+=4){const _=o[a],m=o[a+1],d=o[a+2],$=o[a+3];if($===0)continue;const b=`${_},${m},${d}`,k=rt(b,u);o[a]=V(k)[0],o[a+1]=V(k)[1],o[a+2]=V(k)[2],o[a+3]=$<x.colorDetail?0:255,x.transMode===2&&k==x.imageColors[x.transColor]&&(o[a+3]=0)}x.transMode===1&&(pt(1,1,[0,0,0,0],t,o),l.putImageData(s,0,0));const C=document.createElement("canvas");return C.width=t.width,C.height=t.height,C.getContext("2d").putImageData(s,0,0),{newCanvas:C,topColors:u}}function rt(e,t){let l=null,s=1/0;const o=V(e);return t.forEach(i=>{const c=V(i),u=ut(o,c);u<s&&(s=u,l=i)}),l}function V(e){return e.split(",").map(t=>parseInt(t,10))}function ut(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function dt(e){for(let t=0;t<25;t++)x.colorList[t].color="#000000";for(let t=0;t<10;t++)e[t]&&(x.colorList[t+15].color=R(e[t]))}function pt(e,t,l,s,o){const i=z(e,t,s,o);if(i[3]===0)return;const c=[[e,t]];let u;for(;c.length;){if(u=c.pop(),e=u[0],t=u[1],e<0||e>=s.width||t<0||t>=s.height)continue;let C=z(e,t,s,o);if(!_t(C,i))continue;let v=(e+t*s.width)*4;o.set(l,v),c.push([e+1,t]),c.push([e-1,t]),c.push([e,t+1]),c.push([e,t-1])}}function z(e,t,l,s){var o=(e+t*l.width)*4;return[s[o],s[o+1],s[o+2],s[o+3]]}function _t(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function P(){const e=x.newImageData;if(e==null)return;let t="<mspace=0.2><line-height=0.2><size=0.65>";const o=e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e.width,e.height).data;let i=null;for(let c=0;c<o.length;c+=4){const u=o[c],C=o[c+1],v=o[c+2],a=o[c+3],_=`${u},${C},${v}`;i===null&&(i=_,a!==0&&(t+=`<${A(_)}>`)),_!==i&&a!==0&&(t+=`<${A(_)}>`,i=_),c/4%e.width===0&&(t+="<br>"),a===255?t+=".":t+=" "}return t=t.replace(/\s*<br>/g,"<br>").trimEnd(),t=t.replace(/\s{12,}/g,c=>`<space=${(c.length*.2).toFixed(1).replace(/\.0$/,"")}>`),t}function A(e){const t=R(e),l=x.colorList.findIndex(o=>o.color===t);return at[l]}const mt={class:"qi-slider"},ht=["min","max","step","value"],gt={__name:"Slider",props:{modelValue:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const l=e,s=t,o=c=>{const u=parseInt(c.target.value,10);s("update:modelValue",u),s("change")},i=S(()=>lt(l.modelValue,l.min,l.max,0,100));return(c,u)=>(h(),f("div",mt,[n("input",{type:"range",min:e.min,max:e.max,step:e.step,value:e.modelValue,onInput:o,style:F(`background-size: ${i.value}% 100%`)},null,44,ht)]))}},N=w(gt,[["__scopeId","data-v-34d3e4cc"]]),ft={class:"qi-select flex-x-between"},vt={class:"value_text"},$t={key:0,class:"text"},Ct={__name:"Select",props:{modelValue:{type:Number,required:!0},valueList:{type:Array,default:()=>["开启","关闭"]},isColor:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const l=e,s=t,o=y(l.modelValue),i=c=>{c===0?o.value=o.value<=0?l.valueList.length-1:o.value-1:o.value=o.value>=l.valueList.length-1?0:o.value+1,s("update:modelValue",o.value),s("change")};return(c,u)=>(h(),f("div",ft,[n("div",{class:"button",onClick:u[0]||(u[0]=C=>i(0))},[g(U,{icon:"left",size:"1.5em"})]),n("div",vt,[e.isColor?(h(),f("div",{key:1,class:"color",style:F({backgroundColor:p(R)(e.valueList[e.modelValue])})},null,4)):(h(),f("span",$t,r(e.valueList[e.modelValue]),1))]),n("div",{class:"button",onClick:u[1]||(u[1]=C=>i(1))},[g(U,{icon:"right",size:"1.5em"})])]))}},H=w(Ct,[["__scopeId","data-v-23d91c2e"]]),bt=["accept"],xt={key:0,class:"tipsText flex-y"},wt=["innerHTML"],yt=["src"],Lt={key:2,class:"xmlData"},Tt={__name:"UploadFile",props:{text:{type:String,default:"点击选择文件，或拖拽到此处"},accept:{type:String,default:"image/*"}},emits:["change"],setup(e,{emit:t}){const l=e,s=t;let o=y(!1),i=y(!1),c=y(""),u=y("");function C(d){const $=d.target.files;m($)}function v(d){d.preventDefault(),i.value=!0}function a(d){d.preventDefault(),i.value=!1}function _(d){d.preventDefault(),i.value=!1;const $=d.dataTransfer.files;m($)}function m(d){if(d.length>0){const $=new FileReader;$.readAsDataURL(d[0]),$.onload=function(b){l.accept==="image/*"&&(c.value=b.target.result),l.accept===".xml"&&(u.value=b.target.result),o.value=!0,s("change",b.target.result)}}}return(d,$)=>(h(),f("label",{onDragover:v,onDragleave:a,onDrop:_},[n("input",{type:"file",accept:e.accept,onChange:C},null,40,bt),n("div",{class:q(["uploadFile flex-x-y",{draging:p(i)}])},[p(o)?L("",!0):(h(),f("div",xt,[g(U,{icon:"upload",size:"2em"}),n("div",{class:"text",innerHTML:e.text},null,8,wt)])),p(o)&&e.accept==="image/*"?(h(),f("img",{key:1,src:p(c),alt:""},null,8,yt)):L("",!0),p(o)&&e.accept===".xml"?(h(),f("div",Lt,$[0]||($[0]=[n("span",null,"已选择xml文件",-1)]))):L("",!0)],2)],32))}},Dt=w(Tt,[["__scopeId","data-v-f3a59af5"]]),kt={class:"main_card edit_card"},It={class:"card_title"},Vt={class:"card_title"},Ut={class:"card_content"},St={class:"setting_item"},Mt={class:"content flex-x-between"},Nt={class:"title"},Ft={class:"value"},qt={class:"card_tips"},Rt={class:"setting_item"},Bt={class:"content flex-x-between"},Et={class:"title"},zt={class:"value"},Pt={class:"setting_item"},At={class:"content flex-x-between"},Ht={class:"title"},jt={class:"value"},Ot={key:0,class:"setting_item"},Wt={class:"content flex-x-between"},Xt={class:"title"},Gt={key:1,class:"setting_item"},Jt={class:"content flex-x-between"},Kt={class:"title"},Qt={__name:"edit_card",emits:["change"],setup(e,{emit:t}){const{t:l}=X(),s=D(),o=t,i=y(["imageToLabel.edit.tranMode_off","imageToLabel.edit.tranMode_auto","imageToLabel.edit.tranMode_color"]),c=S(()=>i.value.map(v=>l(v)));function u(v){s.imageData=v,o("change")}const C=()=>{o("change")};return(v,a)=>(h(),f("div",kt,[n("p",It,r(v.$t("imageToLabel.edit.title_1")),1),g(Dt,{accept:"image/*",onChange:u,text:v.$t("imageToLabel.edit.select_image")},null,8,["text"]),n("p",Vt,r(v.$t("imageToLabel.edit.title_2")),1),n("div",Ut,[n("div",St,[n("div",Mt,[n("p",Nt,r(v.$t("imageToLabel.edit.imgw")),1),n("p",Ft,r(p(s).imageWidth),1)]),g(N,{modelValue:p(s).imageWidth,"onUpdate:modelValue":a[0]||(a[0]=_=>p(s).imageWidth=_),onChange:C,min:10,max:400,step:10},null,8,["modelValue"])]),n("div",qt,[n("p",null,r(v.$t("imageToLabel.edit.imgw_tips")),1)]),n("div",Rt,[n("div",Bt,[n("p",Et,r(v.$t("imageToLabel.edit.colorNum")),1),n("p",zt,r(p(s).colorNum),1)]),g(N,{modelValue:p(s).colorNum,"onUpdate:modelValue":a[1]||(a[1]=_=>p(s).colorNum=_),onChange:C,min:1,max:10},null,8,["modelValue"])]),n("div",Pt,[n("div",At,[n("p",Ht,r(v.$t("imageToLabel.edit.tranValue")),1),n("p",jt,r(p(s).colorDetail),1)]),g(N,{modelValue:p(s).colorDetail,"onUpdate:modelValue":a[2]||(a[2]=_=>p(s).colorDetail=_),onChange:C,min:0,max:200,step:1},null,8,["modelValue"])]),p(s).imageColors.length!==0?(h(),f("div",Ot,[n("div",Wt,[n("p",Xt,r(v.$t("imageToLabel.edit.tranMode")),1),g(H,{modelValue:p(s).transMode,"onUpdate:modelValue":a[3]||(a[3]=_=>p(s).transMode=_),onChange:C,"value-list":c.value},null,8,["modelValue","value-list"])])])):L("",!0),p(s).transMode==2?(h(),f("div",Gt,[n("div",Jt,[n("p",Kt,r(v.$t("imageToLabel.edit.tranColor")),1),g(H,{modelValue:p(s).transColor,"onUpdate:modelValue":a[4]||(a[4]=_=>p(s).transColor=_),onChange:C,"value-list":p(s).imageColors,"is-color":!0},null,8,["modelValue","value-list"])])])):L("",!0)])]))}},Yt=w(Qt,[["__scopeId","data-v-68c0aab7"]]),Zt={class:"main_card result_card"},te={class:"card_title"},ee={class:"result_box flex-x-y"},oe=["src"],se={__name:"result_card",setup(e){const t=D(),l=S(()=>{if(t.newImageData!==null)return t.newImageData.toDataURL()}),s=o=>{};return(o,i)=>(h(),f("div",Zt,[n("p",te,r(o.$t("imageToLabel.result.title_1")),1),n("div",ee,[l.value?(h(),f("img",{key:0,src:l.value,onClick:s,alt:""},null,8,oe)):L("",!0)])]))}},ne=w(se,[["__scopeId","data-v-9cc3ffd1"]]),le={class:"qi-toast"},ae={__name:"Toast",props:{message:{type:String,default:"提示文本"},icon:{type:String,default:""}},setup(e){return(t,l)=>(h(),f("div",le,[e.icon?(h(),G(U,{key:0,icon:e.icon},null,8,["icon"])):L("",!0),n("span",null,r(e.message),1)]))}},ie=w(ae,[["__scopeId","data-v-48078998"]]);let j=null,T=null;function O(e,t=1500){T=document.querySelector(".toast-container"),T?M(null,T):(T=document.createElement("div"),T.setAttribute("class","toast-container"),document.querySelector("body").appendChild(T));const l=g(ie,{message:e});M(l,T),clearTimeout(j),j=setTimeout(()=>{M(null,T)},t)}const ce={key:1},re={__name:"Button",props:{text:{type:String,default:""},type:{type:String,default:"default"},icon:{type:String,default:""}},emits:["click"],setup(e,{emit:t}){const l=e,s=S(()=>[`qi-button__${l.type}`]),o=t,i=c=>{o("click")};return(c,u)=>(h(),f("div",{class:q(["qi-button flex-x-y",s.value]),onClick:i},[e.icon?(h(),G(U,{key:0,icon:e.icon,size:"1.3em"},null,8,["icon"])):L("",!0),e.text?(h(),f("span",ce,r(e.text),1)):L("",!0)],2))}},I=w(re,[["__scopeId","data-v-27ac9df2"]]),ue={key:0,class:"popup-box"},de={class:"popup"},pe={class:"top_box flex-x-y"},_e={class:"title"},me={class:"content"},he={__name:"Popup",props:{title:{type:String,default:"弹窗标题"}},setup(e,{expose:t}){const l=y(!1);function s(){l.value=!0}function o(){l.value=!1}return t({show:s}),(i,c)=>l.value?(h(),f("div",ue,[n("div",de,[n("div",pe,[n("p",_e,r(e.title),1),n("div",{class:"close_button flex-x-y",onClick:o},"X")]),n("div",me,[K(i.$slots,"default",{},void 0)])])])):L("",!0)}},W=w(he,[["__scopeId","data-v-98f2569b"]]),ge={},fe={class:"content"},ve={class:"popup_title"},$e={class:"popup_text"},Ce={class:"popup_title"},be={class:"popup_text"},xe={class:"popup_text"},we={class:"popup_text"},ye={class:"popup_text"},Le={class:"popup_title"},Te={class:"popup_text"},De={class:"popup_title"},ke={class:"popup_text"},Ie={class:"popup_text"};function Ve(e,t){return h(),f("div",fe,[n("p",ve,r(e.$t("popup_howToUse.title_1")),1),n("p",$e,r(e.$t("popup_howToUse.text_1")),1),n("p",Ce,r(e.$t("popup_howToUse.title_2")),1),n("p",be,r(e.$t("popup_howToUse.text_2")),1),n("p",xe,r(e.$t("popup_howToUse.text_3")),1),n("p",we,r(e.$t("popup_howToUse.text_4")),1),n("p",ye,r(e.$t("popup_howToUse.text_5")),1),n("p",Le,r(e.$t("popup_howToUse.title_3")),1),n("p",Te,r(e.$t("popup_howToUse.text_6")),1),n("p",De,r(e.$t("popup_howToUse.title_4")),1),n("p",ke,r(e.$t("popup_howToUse.text_7")),1),n("p",Ie,r(e.$t("popup_howToUse.text_8")),1)])}const Ue=w(ge,[["render",Ve]]),Se={class:"content"},Me={__name:"manualCopy",setup(e){const t=D();return(l,s)=>(h(),f("div",Se,[Q(n("textarea",{"onUpdate:modelValue":s[0]||(s[0]=o=>p(t).resultCode=o)},null,512),[[Y,p(t).resultCode]])]))}},Ne=w(Me,[["__scopeId","data-v-d253e806"]]),Fe={class:"main_card color_card"},qe={class:"card_title"},Re={class:"color_box flex-y"},Be={class:"color_list"},Ee=["onClick"],ze={class:"card_content"},Pe={class:"color_hex_text flex-x-y"},Ae={class:"edit_buttons"},He={class:"card_tips"},je={class:"card_title"},Oe={class:"card_content export_buttons"},We={__name:"color_card",setup(e){const t=D();Z();const{t:l}=X(),s=y(null),o=y(null);function i(){for(let m=0;m<25;m++)t.colorList.push({id:m,color:"#000000"})}tt(()=>{t.colorList.length===0&&i()});const c=(m,d)=>{t.activeColor=d},u=m=>{const d=t.activeColor;if(m===0){if(d>0){const $=t.colorList.splice(d,1)[0];t.colorList.splice(d-1,0,$),t.activeColor-=1}}else if(d<t.colorList.length-1){const $=t.colorList.splice(d,1)[0];t.colorList.splice(d+1,0,$),t.activeColor+=1}};let C=S(()=>{var m;return(m=t.colorList[t.activeColor])==null?void 0:m.color.toUpperCase()});const v=()=>{t.resultCode=P(),t.resultCode&&(navigator.clipboard?(navigator.clipboard.writeText(t.resultCode),O(l("toast.copy"))):O(l("toast.copy_err")))},a=()=>{t.resultCode=P(),t.resultCode&&o.value.show()},_=()=>{s.value.show()};return(m,d)=>(h(),f("div",Fe,[n("p",qe,r(m.$t("imageToLabel.color.title_1")),1),n("div",Re,[n("div",Be,[(h(!0),f(et,null,ot(p(t).colorList,($,b)=>(h(),f("div",{key:b,class:q({color_item:!0,active:b==p(t).activeColor}),style:F(`background: ${$.color}`),onClick:k=>c($,b)},null,14,Ee))),128))])]),n("div",ze,[n("div",Pe,[n("span",null,r(p(C)),1)]),n("div",Ae,[g(I,{type:"default",icon:"left",onClick:d[0]||(d[0]=$=>u(0))}),g(I,{type:"default",icon:"right",onClick:d[1]||(d[1]=$=>u(1))})]),n("div",He,[n("p",null,r(m.$t("imageToLabel.color.color_tips")),1)])]),n("p",je,r(m.$t("imageToLabel.color.title_2")),1),n("div",Oe,[g(I,{type:"primary",text:m.$t("imageToLabel.color.btn_copy"),onClick:v},null,8,["text"]),g(I,{type:"default",text:m.$t("imageToLabel.color.btn_m_copy"),onClick:a},null,8,["text"]),g(I,{type:"default",text:m.$t("imageToLabel.color.btn_help"),onClick:_},null,8,["text"])]),g(W,{ref_key:"howToUsePopupRef",ref:s,title:m.$t("popup_howToUse.main_title")},{default:B(()=>[g(Ue)]),_:1},8,["title"]),g(W,{ref_key:"manualCopyPopupRef",ref:o,title:m.$t("popup_manualCopy.main_title")},{default:B(()=>[g(Ne)]),_:1},8,["title"])]))}},Xe=w(We,[["__scopeId","data-v-b1c637e8"]]),Ge={class:"imagetolabel-page"},Je={class:"container"},Ke={__name:"ImageToLabel",setup(e){const t=D(),l=y(null),s=()=>{if(t.imageData==null)return;const o=new Image;o.src=t.imageData,o.onload=function(){const i=ct(o);t.newImageData=i.newCanvas}};return st(()=>{t.reset()}),(o,i)=>(h(),f("div",Ge,[g(nt,{title:o.$t("imageToLabel.title")},null,8,["title"]),n("div",Je,[g(Yt,{onChange:s}),g(ne,{ref_key:"result_card",ref:l},null,512),g(Xe)])]))}},to=w(Ke,[["__scopeId","data-v-4491cd73"]]);export{to as default};
