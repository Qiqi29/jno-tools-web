import{u as D}from"./label_data-Cspw0m3z.js";import{i as q,t as G}from"./Topbar-BLG-Er3H.js";import{_ as v,f as E,o as m,c as _,a as l,n as B,g as P,d as f,t as $,u as p,h as y,b as W,i as j,j as V,k as K,l as O,F as X,m as J}from"./index-Ck3fI6ev.js";function M(e){let t=e;typeof e=="string"&&(t=e.split(",").map(a=>parseInt(a,10)));const n=a=>{const o=a.toString(16);return o.length===1?"0"+o:o};return"#"+n(t[0])+n(t[1])+n(t[2])}function Q(e,t,n,a,o){const c=(e-t)/(n-t),r=a+c*(o-a);return Math.min(o,Math.max(a,r))}const h=D(),Y=["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0A0A0A","#0B0B0B","#0C0C0C","#0D0D0D","#0E0E0E","#0F0F0F","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818"];function Z(e,t){const n=document.createElement("canvas"),a=n.getContext("2d"),o=t/e.width*e.height;return n.width=t,n.height=o,a.drawImage(e,0,0,t,o),n}function tt(e){const t=Z(e,h.imageWidth),n=t.getContext("2d",{willReadFrequently:!0}),a=n.getImageData(0,0,t.width,t.height),o=a.data,c={};for(let i=0;i<o.length;i+=4){const u=o[i],g=o[i+1],w=o[i+2];if(o[i+3]===0)continue;const k=`${u},${g},${w}`;c[k]?c[k]++:c[k]=1}const s=Object.entries(c).sort((i,u)=>u[1]-i[1]).slice(0,h.colorNum).map(i=>i[0]);h.imageColors=s,nt(s);for(let i=0;i<o.length;i+=4){const u=o[i],g=o[i+1],w=o[i+2],S=o[i+3];if(S===0)continue;const k=`${u},${g},${w}`,N=et(k,s);o[i]=L(N)[0],o[i+1]=L(N)[1],o[i+2]=L(N)[2],o[i+3]=S<h.colorDetail?0:255,h.transMode===2&&N==h.imageColors[h.transColor]&&(o[i+3]=0)}h.transMode===1&&(st(1,1,[0,0,0,0],t,o),n.putImageData(a,0,0));const d=document.createElement("canvas");return d.width=t.width,d.height=t.height,d.getContext("2d").putImageData(a,0,0),{newCanvas:d,topColors:s}}function et(e,t){let n=null,a=1/0;const o=L(e);return t.forEach(c=>{const r=L(c),s=ot(o,r);s<a&&(a=s,n=c)}),n}function L(e){return e.split(",").map(t=>parseInt(t,10))}function ot(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function nt(e){for(let t=0;t<25;t++)h.colorList[t].color="#000000";for(let t=0;t<10;t++)e[t]&&(h.colorList[t+15].color=M(e[t]))}function st(e,t,n,a,o){const c=F(e,t,a,o);if(c[3]===0)return;const r=[[e,t]];let s;for(;r.length;){if(s=r.pop(),e=s[0],t=s[1],e<0||e>=a.width||t<0||t>=a.height)continue;let d=F(e,t,a,o);if(!lt(d,c))continue;let C=(e+t*a.width)*4;o.set(n,C),r.push([e+1,t]),r.push([e-1,t]),r.push([e,t+1]),r.push([e,t-1])}}function F(e,t,n,a){var o=(e+t*n.width)*4;return[a[o],a[o+1],a[o+2],a[o+3]]}function lt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function z(){const e=h.newImageData;if(e==null)return;let t="<mspace=0.2><line-height=0.2><size=0.65>";const o=e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e.width,e.height).data;let c=null;for(let r=0;r<o.length;r+=4){const s=o[r],d=o[r+1],C=o[r+2],i=o[r+3],u=`${s},${d},${C}`;c===null&&(c=u,i!==0&&(t+=`<${A(u)}>`)),u!==c&&i!==0&&(t+=`<${A(u)}>`,c=u),r/4%e.width===0&&(t+="<br>"),i===255?t+=".":t+=" "}return t.trimEnd()}function A(e){const t=M(e),n=h.colorList.findIndex(o=>o.color===t);return Y[n]}const at={class:"qi-slider"},it=["min","max","step","value"],ct={__name:"Slider",props:{modelValue:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,a=t,o=r=>{const s=parseInt(r.target.value,10);a("update:modelValue",s),a("change")},c=E(()=>Q(n.modelValue,n.min,n.max,0,100));return(r,s)=>(m(),_("div",at,[l("input",{type:"range",min:e.min,max:e.max,step:e.step,value:e.modelValue,onInput:o,style:B(`background-size: ${c.value}% 100%`)},null,44,it)]))}},T=v(ct,[["__scopeId","data-v-34d3e4cc"]]),rt={class:"qi-select flex-x-between"},ut={class:"value_text"},dt={key:0,class:"text"},pt={__name:"Select",props:{modelValue:{type:Number,required:!0},valueList:{type:Array,default:()=>["开启","关闭"]},isColor:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,a=t,o=P(n.modelValue),c=r=>{r===0?o.value=o.value<=0?n.valueList.length-1:o.value-1:o.value=o.value>=n.valueList.length-1?0:o.value+1,a("update:modelValue",o.value),a("change")};return(r,s)=>(m(),_("div",rt,[l("div",{class:"button",onClick:s[0]||(s[0]=d=>c(0))},[f(q,{icon:"left",size:"1.5em"})]),l("div",ut,[e.isColor?(m(),_("div",{key:1,class:"color",style:B({backgroundColor:p(M)(e.valueList[e.modelValue])})},null,4)):(m(),_("span",dt,$(e.valueList[e.modelValue]),1))]),l("div",{class:"button",onClick:s[1]||(s[1]=d=>c(1))},[f(q,{icon:"right",size:"1.5em"})])]))}},R=v(pt,[["__scopeId","data-v-c1a26889"]]),mt={class:"main_card edit_card"},_t={class:"upload_image_box flex-x-y"},ft={key:0},gt=["src"],ht={class:"card_content"},vt={class:"setting_item"},Ct={class:"content flex-x-between"},xt={class:"value"},bt={class:"setting_item"},$t={class:"content flex-x-between"},yt={class:"value"},wt={class:"setting_item"},Vt={class:"content flex-x-between"},kt={class:"value"},It={class:"setting_item"},Lt={class:"content flex-x-between"},Dt={key:0,class:"setting_item"},St={class:"content flex-x-between"},Nt={__name:"edit_card",emits:["change"],setup(e,{emit:t}){const n=D(),a=t;function o(r){const s=r.target.files;if(s.length>0){const d=new FileReader;d.readAsDataURL(s[0]),d.onload=function(C){n.imageData=C.target.result,a("change")}}}const c=()=>{a("change")};return(r,s)=>(m(),_("div",mt,[s[11]||(s[11]=l("p",{class:"card_title"},"原始图片",-1)),l("label",null,[l("input",{type:"file",accept:"image/*",onChange:o},null,32),l("div",_t,[p(n).imageData?y("",!0):(m(),_("p",ft,"点击选择图片")),p(n).imageData?(m(),_("img",{key:1,src:p(n).imageData,alt:""},null,8,gt)):y("",!0)])]),s[12]||(s[12]=l("p",{class:"card_title"},"参数设置",-1)),l("div",ht,[l("div",vt,[l("div",Ct,[s[5]||(s[5]=l("p",{class:"title"},"图像宽度",-1)),l("p",xt,$(p(n).imageWidth),1)]),f(T,{modelValue:p(n).imageWidth,"onUpdate:modelValue":s[0]||(s[0]=d=>p(n).imageWidth=d),onChange:c,min:10,max:400,step:10},null,8,["modelValue"])]),s[10]||(s[10]=l("div",{class:"card_tips"},[l("p",null,"越宽越清晰，转换后的数据也越大。Label 零件有字符数量限制，推荐正方形图像宽度在200以内。")],-1)),l("div",bt,[l("div",$t,[s[6]||(s[6]=l("p",{class:"title"},"颜色数量",-1)),l("p",yt,$(p(n).colorNum),1)]),f(T,{modelValue:p(n).colorNum,"onUpdate:modelValue":s[1]||(s[1]=d=>p(n).colorNum=d),onChange:c,min:1,max:10},null,8,["modelValue"])]),l("div",wt,[l("div",Vt,[s[7]||(s[7]=l("p",{class:"title"},"透明精细度",-1)),l("p",kt,$(p(n).colorDetail),1)]),f(T,{modelValue:p(n).colorDetail,"onUpdate:modelValue":s[2]||(s[2]=d=>p(n).colorDetail=d),onChange:c,min:0,max:200,step:1},null,8,["modelValue"])]),l("div",It,[l("div",Lt,[s[8]||(s[8]=l("p",{class:"title"},"透明模式",-1)),f(R,{modelValue:p(n).transMode,"onUpdate:modelValue":s[3]||(s[3]=d=>p(n).transMode=d),onChange:c,"value-list":p(n).transModeList},null,8,["modelValue","value-list"])])]),p(n).transMode==2?(m(),_("div",Dt,[l("div",St,[s[9]||(s[9]=l("p",{class:"title"},"透明颜色",-1)),f(R,{modelValue:p(n).transColor,"onUpdate:modelValue":s[4]||(s[4]=d=>p(n).transColor=d),onChange:c,"value-list":p(n).imageColors,"is-color":!0},null,8,["modelValue","value-list"])])])):y("",!0)])]))}},qt=v(Nt,[["__scopeId","data-v-081fe378"]]),Et={class:"main_card result_card"},Tt={class:"result_box flex-x-y"},Bt=["src"],Mt={__name:"result_card",setup(e){const t=D(),n=E(()=>{if(t.newImageData!==null)return t.newImageData.toDataURL()});return(a,o)=>(m(),_("div",Et,[o[0]||(o[0]=l("p",{class:"card_title"},"转换预览",-1)),l("div",Tt,[n.value?(m(),_("img",{key:0,src:n.value,alt:""},null,8,Bt)):y("",!0)])]))}},Ft=v(Mt,[["__scopeId","data-v-4ab1d1ff"]]),zt={key:1},At={__name:"Button",props:{text:{type:String,default:""},type:{type:String,default:"default"},icon:{type:String,default:""}},emits:["click"],setup(e,{emit:t}){const n=e,a=E(()=>[`qi-button__${n.type}`]),o=t,c=r=>{o("click")};return(r,s)=>(m(),_("div",{class:j(["qi-button flex-x-y",a.value]),onClick:c},[e.icon?(m(),W(q,{key:0,icon:e.icon,size:"1.3em"},null,8,["icon"])):y("",!0),e.text?(m(),_("span",zt,$(e.text),1)):y("",!0)],2))}},I=v(At,[["__scopeId","data-v-b9cb7a56"]]),Rt={class:"qi-toast"},Ut={__name:"Toast",props:{message:{type:String,default:"提示文本"},icon:{type:String,default:""}},setup(e){return(t,n)=>(m(),_("div",Rt,[e.icon?(m(),W(q,{key:0,icon:e.icon},null,8,["icon"])):y("",!0),l("span",null,$(e.message),1)]))}},Ht=v(Ut,[["__scopeId","data-v-48078998"]]);let U=null,x=null;function H(e,t=1500){x=document.querySelector(".toast-container"),x?V(null,x):(x=document.createElement("div"),x.setAttribute("class","toast-container"),document.querySelector("body").appendChild(x));const n=f(Ht,{message:e});V(n,x),clearTimeout(U),U=setTimeout(()=>{V(null,x)},t)}const Pt={class:"qi-popup-box"},Wt={class:"popup"},jt={class:"top_box flex-x-y"},Gt={class:"title"},Kt=["innerHTML"],Ot={__name:"Popup",props:{title:{type:String,default:"弹窗标题"},text:{type:String,default:""}},setup(e){const t=()=>{Qt()};return(n,a)=>(m(),_("div",Pt,[l("div",Wt,[l("div",jt,[l("p",Gt,$(e.title),1),l("div",{class:"close_button flex-x-y",onClick:t},"X")]),e.text?(m(),_("div",{key:0,class:"content",innerHTML:e.text},null,8,Kt)):y("",!0)])]))}},Xt=v(Ot,[["__scopeId","data-v-9c6765b5"]]);let b=null;function Jt(e,t){b=document.querySelector(".popup-container"),b?V(null,b):(b=document.createElement("div"),b.setAttribute("class","popup-container"),document.querySelector("body").appendChild(b));const n=f(Xt,{title:e,text:t});V(n,b)}function Qt(){V(null,b)}const Yt={class:"main_card color_card"},Zt={class:"color_box flex-y"},te={class:"color_list"},ee=["onClick"],oe={class:"card_content"},ne={class:"color_hex_text flex-x-y"},se={class:"edit_buttons"},le={class:"card_content export_buttons"},ae={__name:"color_card",setup(e){const t=D(),n=K();function a(){for(let i=0;i<25;i++)t.colorList.push({id:i,color:"#000000"})}O(()=>{t.colorList.length===0&&a()});const o=(i,u)=>{t.activeColor=u},c=i=>{const u=t.activeColor;if(i===0){if(u>0){const g=t.colorList.splice(u,1)[0];t.colorList.splice(u-1,0,g),t.activeColor-=1}}else if(u<t.colorList.length-1){const g=t.colorList.splice(u,1)[0];t.colorList.splice(u+1,0,g),t.activeColor+=1}};let r=E(()=>{var i;return(i=t.colorList[t.activeColor])==null?void 0:i.color.toUpperCase()});const s=()=>{t.resultCode=z(),t.resultCode&&(navigator.clipboard?(navigator.clipboard.writeText(t.resultCode),H("已复制代码")):H("复制失败，请手动复制"))},d=()=>{t.resultCode=z(),t.resultCode&&n.push("/tool/imagetolabel/copycode")},C=()=>{Jt("使用方法",`
        <p class="popup_title">1. 粘贴代码</p>
        <p class="popup_text">把复制的代码粘贴到 Lable 零件的输入框中。</p>

        <p class="popup_title">2. 设置 Label 零件的属性</p>
        <p class="popup_text">字体（Font）设置为 Future Earth。</p>
        <p class="popup_text">水平锚点（Horizontal Anchor）设置为 Left。</p>
        <p class="popup_text">垂直锚点（Vertical Anchor）设置为 Top。</p>
        <p class="popup_text">梯度（Gradient）设置为 Vertical。</p>
        
        <p class="popup_title">3. 调整图像大小</p>
        <p class="popup_text">在 TINKER PANEL 选项内通过 Part Scale（零件大小）调整图像的大小。</p>
        
        <p class="popup_title">小提示</p>
        <p class="popup_text">推荐使用清晰、对比度高、颜色较少的图像进行转换。</p>
        <p class="popup_text">粘贴代码后，如果图像异常，把 FontSize、Width、Height 属性都拉到最大，然后再缩小到合适的大小</p>
    `)};return(i,u)=>(m(),_("div",Yt,[u[3]||(u[3]=l("p",{class:"card_title"},"颜色编辑",-1)),l("div",Zt,[l("div",te,[(m(!0),_(X,null,J(p(t).colorList,(g,w)=>(m(),_("div",{key:w,class:j({color_item:!0,active:w==p(t).activeColor}),style:B(`background: ${g.color}`),onClick:S=>o(g,w)},null,14,ee))),128))])]),l("div",oe,[l("div",ne,[l("span",null,$(p(r)),1)]),l("div",se,[f(I,{type:"default",icon:"left",onClick:u[0]||(u[0]=g=>c(0))}),f(I,{type:"default",icon:"right",onClick:u[1]||(u[1]=g=>c(1))})]),u[2]||(u[2]=l("div",{class:"card_tips"},[l("p",null,"这里的颜色顺序与游戏内一致，颜色不会保存在代码中，需要在游戏内对应位置修改颜色。")],-1))]),u[4]||(u[4]=l("p",{class:"card_title"},"导出",-1)),l("div",le,[f(I,{type:"primary",text:"复制代码",onClick:s}),f(I,{type:"default",text:"手动复制",onClick:d}),f(I,{type:"default",text:"使用方法",onClick:C})])]))}},ie=v(ae,[["__scopeId","data-v-70971dfb"]]),ce={class:"imagetolabel-page"},re={class:"container"},ue={__name:"ImageToLabel",setup(e){const t=D(),n=P(null),a=()=>{if(t.imageData==null)return;const o=new Image;o.src=t.imageData,o.onload=function(){const c=tt(o);t.newImageData=c.newCanvas}};return(o,c)=>(m(),_("div",ce,[f(G,{title:"图片转 Label"}),l("div",re,[f(qt,{onChange:a}),f(Ft,{ref_key:"result_card",ref:n},null,512),f(ie)])]))}},_e=v(ue,[["__scopeId","data-v-631ad654"]]);export{_e as default};
