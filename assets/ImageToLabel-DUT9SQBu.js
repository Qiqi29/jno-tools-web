import{g as se,_ as w,h as S,o as f,c as $,a as s,n as R,r as b,w as U,v as le,b as v,t as d,f as m,d as T,i as K,j as Y,k as Z,l as N,m as q,T as E,p as ne,q as ae,s as z,x as ie,y as P,F as ee,z as te,u as ce,A as re,B as ue}from"./index-SdcPHFtT.js";import{Q as de}from"./Topbar-RxmTMtWn.js";import{i as A}from"./Icon-CwC--XFN.js";import{b as D}from"./Button-BTihmnir.js";function B(t){let e=t;typeof t=="string"&&(e=t.split(",").map(l=>parseInt(l,10)));const n=l=>{const o=l.toString(16);return o.length===1?"0"+o:o};return"#"+n(e[0])+n(e[1])+n(e[2])}function pe(t,e,n,l,o){const i=(t-e)/(n-e),r=l+i*(o-l);return Math.min(o,Math.max(l,r))}const H={imageData:null,newImageData:null,resultCode:null,imageWidth:150,colorNum:3,colorDetail:100,colorAlgorithm:!1,colorIntensity:30,transMode:0,transModeList:["关闭","自动","指定颜色"],transColor:0,imageColors:[],activeColor:15,colorList:[]},k=se("label_date",{state:()=>({...H}),actions:{reset(){Object.assign(this,H),this.colorList=[]}}}),x=k(),_e=["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0A0A0A","#0B0B0B","#0C0C0C","#0D0D0D","#0E0E0E","#0F0F0F","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818"];function me(t,e){const n=document.createElement("canvas"),l=n.getContext("2d",{willReadFrequently:!0}),o=e/t.width*t.height;return n.width=e,n.height=o,l.drawImage(t,0,0,e,o),n}function he(t){const e=me(t,x.imageWidth),n=e.getContext("2d",{willReadFrequently:!0}),l=n.getImageData(0,0,e.width,e.height),o=l.data,i={};for(let a=0;a<o.length;a+=16){const g=o[a],_=o[a+1],C=o[a+2];if(o[a+3]===0)continue;const I=`${g},${_},${C}`;i[I]?i[I]++:i[I]=1}const r={};x.colorAlgorithm&&Object.keys(i).forEach(a=>{let g=!1;Object.keys(r).forEach(_=>{if(oe(V(a),V(_))<x.colorIntensity){r[_]+=i[a],g=!0;return}}),g||(r[a]=i[a])});const c=Object.entries(x.colorAlgorithm?r:i).sort((a,g)=>g[1]-a[1]).slice(0,x.colorNum).map(a=>a[0]);x.imageColors=c,fe(c);for(let a=0;a<o.length;a+=4){const g=o[a],_=o[a+1],C=o[a+2],y=o[a+3];if(y===0)continue;const I=`${g},${_},${C}`,M=ge(I,c);o[a]=V(M)[0],o[a+1]=V(M)[1],o[a+2]=V(M)[2],o[a+3]=y<x.colorDetail?0:255,x.transMode===2&&M==x.imageColors[x.transColor]&&(o[a+3]=0)}x.transMode===1&&(ve(1,1,[0,0,0,0],e,o),n.putImageData(l,0,0));const u=document.createElement("canvas");return u.width=e.width,u.height=e.height,u.getContext("2d",{willReadFrequently:!0}).putImageData(l,0,0),{newCanvas:u,topColors:c}}function ge(t,e){let n=null,l=1/0;const o=V(t);return e.forEach(i=>{const r=V(i),p=oe(o,r);p<l&&(l=p,n=i)}),n}function V(t){return t.split(",").map(e=>parseInt(e,10))}function oe(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function fe(t){for(let e=0;e<25;e++)x.colorList[e].color="#000000";for(let e=0;e<10;e++)t[e]&&(x.colorList[e+15].color=B(t[e]))}function ve(t,e,n,l,o){const i=j(t,e,l,o);if(i[3]===0)return;const r=[[t,e]];let p;for(;r.length;){if(p=r.pop(),t=p[0],e=p[1],t<0||t>=l.width||e<0||e>=l.height)continue;let c=j(t,e,l,o);if(!$e(c,i))continue;let u=(t+e*l.width)*4;o.set(n,u),r.push([t+1,e]),r.push([t-1,e]),r.push([t,e+1]),r.push([t,e-1])}}function j(t,e,n,l){var o=(t+e*n.width)*4;return[l[o],l[o+1],l[o+2],l[o+3]]}function $e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function O(){const t=x.newImageData;if(t==null)return;let e="<mspace=0.2><line-height=0.2><size=0.65>";const o=t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,t.width,t.height).data;let i=null;for(let r=0;r<o.length;r+=4){const p=o[r],c=o[r+1],u=o[r+2],h=o[r+3],a=`${p},${c},${u}`;i===null&&(i=a,h!==0&&(e+=`<${W(a)}>`)),a!==i&&h!==0&&(e+=`<${W(a)}>`,i=a),r/4%t.width===0&&(e+="<br>"),h===255?e+=".":e+=" "}return e=e.replace(/\s*<br>/g,"<br>").trimEnd(),e=e.replace(/\s{12,}/g,r=>`<space=${(r.length*.2).toFixed(1).replace(/\.0$/,"")}>`),e}function W(t){const e=B(t),n=x.colorList.findIndex(o=>o.color===e);return _e[n]}const Ce={class:"qi-slider"},xe=["min","max","step","value"],be={__name:"Slider",props:{modelValue:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["update:modelValue","change","touchup"],setup(t,{emit:e}){const n=t,l=e,o=p=>{const c=parseInt(p.target.value,10);l("update:modelValue",c),l("change")},i=p=>{l("touchup")},r=S(()=>pe(n.modelValue,n.min,n.max,0,100));return(p,c)=>(f(),$("div",Ce,[s("input",{type:"range",min:t.min,max:t.max,step:t.step,value:t.modelValue,style:R(`background-size: ${r.value}% 100%`),onInput:o,onMouseup:i,onTouchend:i},null,44,xe)]))}},F=w(be,[["__scopeId","data-v-1103b91c"]]),we={class:"qi-switch"},ye={class:"switch-label"},Te=["checked"],Le={__name:"Switch",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","change"],setup(t,{emit:e}){const n=t,l=e,o=b(n.modelValue),i=r=>{l("update:modelValue",o.value),l("change")};return(r,p)=>(f(),$("div",we,[s("label",ye,[U(s("input",{type:"checkbox","onUpdate:modelValue":p[0]||(p[0]=c=>o.value=c),checked:t.modelValue,onChange:i},null,40,Te),[[le,o.value]]),p[1]||(p[1]=s("div",{class:"slider"},[s("div",{class:"slider-button"})],-1))])]))}},Ve=w(Le,[["__scopeId","data-v-5847a79a"]]),Ie={class:"qi-select flex-x-between"},ke={class:"value_text"},De={key:0,class:"text"},Ue={__name:"Select",props:{modelValue:{type:Number,required:!0},valueList:{type:Array,default:()=>["开启","关闭"]},isColor:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:e}){const n=t,l=e,o=b(n.modelValue),i=r=>{r===0?o.value=o.value<=0?n.valueList.length-1:o.value-1:o.value=o.value>=n.valueList.length-1?0:o.value+1,l("update:modelValue",o.value),l("change")};return(r,p)=>(f(),$("div",Ie,[s("div",{class:"button flex-x-y",onClick:p[0]||(p[0]=c=>i(0))},[v(A,{icon:"left",size:"1.4em"})]),s("div",ke,[t.isColor?(f(),$("div",{key:1,class:"color",style:R({backgroundColor:m(B)(t.valueList[t.modelValue])})},null,4)):(f(),$("span",De,d(t.valueList[t.modelValue]),1))]),s("div",{class:"button flex-x-y",onClick:p[1]||(p[1]=c=>i(1))},[v(A,{icon:"right",size:"1.4em"})])]))}},Q=w(Ue,[["__scopeId","data-v-b16e0a64"]]),Se=["accept"],Me={key:0,class:"tipsText flex-y"},Fe=["innerHTML"],qe=["src"],Ae={key:2,class:"xmlData"},Ne={__name:"UploadFile",props:{text:{type:String,default:"点击选择文件，或拖拽到此处"},accept:{type:String,default:"image/*"}},emits:["change"],setup(t,{emit:e}){const n=t,l=e;let o=b(!1),i=b(!1),r=b(""),p=b("");function c(_){const C=_.target.files;g(C)}function u(_){_.preventDefault(),i.value=!0}function h(_){_.preventDefault(),i.value=!1}function a(_){_.preventDefault(),i.value=!1;const C=_.dataTransfer.files;g(C)}function g(_){if(_.length>0){const C=new FileReader;C.readAsDataURL(_[0]),C.onload=function(y){n.accept==="image/*"&&(r.value=y.target.result),n.accept===".xml"&&(p.value=y.target.result),o.value=!0,l("change",y.target.result)}}}return(_,C)=>(f(),$("label",{onDragover:u,onDragleave:h,onDrop:a},[s("input",{type:"file",accept:t.accept,onChange:c},null,40,Se),s("div",{class:K(["uploadFile flex-x-y",{draging:m(i)}])},[m(o)?T("",!0):(f(),$("div",Me,[v(A,{icon:"upload",size:"2em"}),s("div",{class:"text",innerHTML:t.text},null,8,Fe)])),m(o)&&t.accept==="image/*"?(f(),$("img",{key:1,src:m(r),alt:""},null,8,qe)):T("",!0),m(o)&&t.accept===".xml"?(f(),$("div",Ae,C[0]||(C[0]=[s("span",null,"已选择xml文件",-1)]))):T("",!0)],2)],32))}},Re=w(Ne,[["__scopeId","data-v-f3a59af5"]]),Be={class:"main_card edit_card"},Ee={class:"card_title"},ze={class:"card_title"},Pe={class:"card_content"},He={class:"setting_item"},je={class:"content flex-x-between"},Oe={class:"title"},We={class:"value"},Qe={class:"card_tips"},Xe={class:"setting_item"},Ge={class:"content flex-x-between"},Je={class:"title"},Ke={class:"value"},Ye={class:"setting_item"},Ze={class:"content flex-x-between"},et={class:"title"},tt={key:0,class:"setting_item"},ot={class:"content flex-x-between"},st={class:"title"},lt={class:"value"},nt={class:"setting_item"},at={class:"content flex-x-between"},it={class:"title"},ct={class:"value"},rt={key:1,class:"setting_item"},ut={class:"content flex-x-between"},dt={class:"title"},pt={key:2,class:"setting_item"},_t={class:"content flex-x-between"},mt={class:"title"},ht={__name:"edit_card",emits:["change"],setup(t,{emit:e}){const{t:n}=Y(),l=k(),o=e,i=b(["imageToLabel.edit.tranMode_off","imageToLabel.edit.tranMode_auto","imageToLabel.edit.tranMode_color"]),r=S(()=>i.value.map(u=>n(u)));function p(u){l.imageData=u,o("change")}const c=()=>{o("change")};return(u,h)=>(f(),$("div",Be,[s("p",Ee,d(u.$t("imageToLabel.edit.title_1")),1),v(Re,{accept:"image/*",onChange:p,text:u.$t("imageToLabel.edit.select_image")},null,8,["text"]),s("p",ze,d(u.$t("imageToLabel.edit.title_2")),1),s("div",Pe,[s("div",He,[s("div",je,[s("p",Oe,d(u.$t("imageToLabel.edit.imgw")),1),s("p",We,d(m(l).imageWidth),1)]),v(F,{modelValue:m(l).imageWidth,"onUpdate:modelValue":h[0]||(h[0]=a=>m(l).imageWidth=a),onTouchup:c,min:10,max:400,step:10},null,8,["modelValue"])]),s("div",Qe,[s("p",null,d(u.$t("imageToLabel.edit.imgw_tips")),1)]),s("div",Xe,[s("div",Ge,[s("p",Je,d(u.$t("imageToLabel.edit.colorNum")),1),s("p",Ke,d(m(l).colorNum),1)]),v(F,{modelValue:m(l).colorNum,"onUpdate:modelValue":h[1]||(h[1]=a=>m(l).colorNum=a),onTouchup:c,min:1,max:10},null,8,["modelValue"])]),s("div",Ye,[s("div",Ze,[s("p",et,d(u.$t("imageToLabel.edit.colorAl")),1),v(Ve,{modelValue:m(l).colorAlgorithm,"onUpdate:modelValue":h[2]||(h[2]=a=>m(l).colorAlgorithm=a),onChange:c},null,8,["modelValue"])])]),m(l).colorAlgorithm?(f(),$("div",tt,[s("div",ot,[s("p",st,d(u.$t("imageToLabel.edit.colorin")),1),s("p",lt,d(m(l).colorIntensity),1)]),v(F,{modelValue:m(l).colorIntensity,"onUpdate:modelValue":h[3]||(h[3]=a=>m(l).colorIntensity=a),onTouchup:c,min:10,max:200,step:1},null,8,["modelValue"])])):T("",!0),s("div",nt,[s("div",at,[s("p",it,d(u.$t("imageToLabel.edit.tranValue")),1),s("p",ct,d(m(l).colorDetail),1)]),v(F,{modelValue:m(l).colorDetail,"onUpdate:modelValue":h[4]||(h[4]=a=>m(l).colorDetail=a),onTouchup:c,min:0,max:200,step:1},null,8,["modelValue"])]),m(l).imageColors.length!==0?(f(),$("div",rt,[s("div",ut,[s("p",dt,d(u.$t("imageToLabel.edit.tranMode")),1),v(Q,{modelValue:m(l).transMode,"onUpdate:modelValue":h[5]||(h[5]=a=>m(l).transMode=a),onChange:c,"value-list":r.value},null,8,["modelValue","value-list"])])])):T("",!0),m(l).transMode==2?(f(),$("div",pt,[s("div",_t,[s("p",mt,d(u.$t("imageToLabel.edit.tranColor")),1),v(Q,{modelValue:m(l).transColor,"onUpdate:modelValue":h[6]||(h[6]=a=>m(l).transColor=a),onChange:c,"value-list":m(l).imageColors,"is-color":!0},null,8,["modelValue","value-list"])])])):T("",!0)])]))}},gt=w(ht,[["__scopeId","data-v-551b1fa0"]]),ft={class:"main_card result_card"},vt={class:"card_title"},$t={class:"result_box flex-x-y"},Ct=["src"],xt={__name:"result_card",setup(t){const e=k(),n=S(()=>{if(e.newImageData!==null)return e.newImageData.toDataURL()}),l=o=>{};return(o,i)=>(f(),$("div",ft,[s("p",vt,d(o.$t("imageToLabel.result.title_1")),1),s("div",$t,[n.value?(f(),$("img",{key:0,src:n.value,onClick:l,alt:""},null,8,Ct)):T("",!0)])]))}},bt=w(xt,[["__scopeId","data-v-01d871a0"]]),wt={class:"qi-toast"},yt={__name:"Toast",props:{message:{type:String,default:"提示文本"},icon:{type:String,default:""}},setup(t){return(e,n)=>(f(),$("div",wt,[t.icon?(f(),Z(A,{key:0,icon:t.icon},null,8,["icon"])):T("",!0),s("span",null,d(t.message),1)]))}},Tt=w(yt,[["__scopeId","data-v-48078998"]]);let X=null,L=null;function G(t,e=1500){L=document.querySelector(".toast-container"),L?N(null,L):(L=document.createElement("div"),L.setAttribute("class","toast-container"),document.querySelector("body").appendChild(L));const n=v(Tt,{message:t});N(n,L),clearTimeout(X),X=setTimeout(()=>{N(null,L)},e)}const Lt={class:"top_box flex-x-y"},Vt={class:"title"},It={class:"content"},kt={__name:"Popup",props:{title:{type:String,default:"弹窗标题"}},setup(t,{expose:e}){const n=b(!1);b(!1);function l(){n.value=!0}function o(){n.value=!1}return e({show:l}),(i,r)=>(f(),Z(E,{name:"fade-bg"},{default:q(()=>[U(s("div",{class:"popup-bg",onClick:o},[v(E,{name:"fade-popup"},{default:q(()=>[U(s("div",{class:"popup",onClick:r[0]||(r[0]=ne(()=>{},["stop"]))},[s("div",Lt,[s("p",Vt,d(t.title),1),s("div",{class:"close_button flex-x-y",onClick:o},"X")]),s("div",It,[ae(i.$slots,"default",{},void 0,!0)])],512),[[z,n.value]])]),_:3})],512),[[z,n.value]])]),_:3}))}},J=w(kt,[["__scopeId","data-v-ec449a0a"]]),Dt={},Ut={class:"content"},St={class:"popup_title"},Mt={class:"popup_text"},Ft={class:"popup_title"},qt={class:"popup_text"},At={class:"popup_text"},Nt={class:"popup_text"},Rt={class:"popup_text"},Bt={class:"popup_title"},Et={class:"popup_text"},zt={class:"popup_title"},Pt={class:"popup_text"},Ht={class:"popup_text"};function jt(t,e){return f(),$("div",Ut,[s("p",St,d(t.$t("popup_howToUse.title_1")),1),s("p",Mt,d(t.$t("popup_howToUse.text_1")),1),s("p",Ft,d(t.$t("popup_howToUse.title_2")),1),s("p",qt,d(t.$t("popup_howToUse.text_2")),1),s("p",At,d(t.$t("popup_howToUse.text_3")),1),s("p",Nt,d(t.$t("popup_howToUse.text_4")),1),s("p",Rt,d(t.$t("popup_howToUse.text_5")),1),s("p",Bt,d(t.$t("popup_howToUse.title_3")),1),s("p",Et,d(t.$t("popup_howToUse.text_6")),1),s("p",zt,d(t.$t("popup_howToUse.title_4")),1),s("p",Pt,d(t.$t("popup_howToUse.text_7")),1),s("p",Ht,d(t.$t("popup_howToUse.text_8")),1)])}const Ot=w(Dt,[["render",jt]]),Wt={class:"content"},Qt={class:"input_box flex-x"},Xt={class:"text_conut text_show flex-x-y"},Gt={key:0},Jt={class:"input_list"},Kt={class:"input_num text_show flex-x-y"},Yt=["value"],Zt={__name:"manualCopy",setup(t){const e=k(),n=b(""),l=b([]);ie(()=>e.resultCode,()=>{n.value="",l.value=[]});const o=S(()=>n.value.length),i=()=>{l.value=r(e.resultCode,o.value)};function r(p,c){const u=[];let h=0;for(;h<p.length;){const a=h+c;u.push(p.substring(h,a)),h=a}return u}return(p,c)=>(f(),$("div",Wt,[c[4]||(c[4]=s("p",{class:"popup_title"},"完整代码",-1)),U(s("textarea",{"onUpdate:modelValue":c[0]||(c[0]=u=>m(e).resultCode=u)},null,512),[[P,m(e).resultCode]]),c[5]||(c[5]=s("p",{class:"popup_title"},"手机剪切板有限制？",-1)),c[6]||(c[6]=s("p",{class:"popup_text"},"把上面的代码复制后粘贴到输入框内↓",-1)),s("div",Qt,[U(s("input",{type:"text","onUpdate:modelValue":c[1]||(c[1]=u=>n.value=u),onInput:i},null,544),[[P,n.value]]),s("div",Xt,d(o.value),1)]),l.value.length!==0?(f(),$("div",Gt,[c[2]||(c[2]=s("p",{class:"popup_title"},"分段复制",-1)),c[3]||(c[3]=s("p",{class:"popup_text"},"请按顺序复制到 Label 零件中。",-1)),s("div",Jt,[(f(!0),$(ee,null,te(l.value,(u,h)=>(f(),$("div",{class:"input_box flex-x",key:h},[s("div",Kt,d(h+1),1),s("input",{type:"text",value:u},null,8,Yt)]))),128))])])):T("",!0)]))}},eo=w(Zt,[["__scopeId","data-v-adc376cf"]]),to={class:"main_card color_card"},oo={class:"card_title"},so={class:"color_box flex-y"},lo={class:"color_list"},no=["onClick"],ao={class:"card_content"},io={class:"color_hex_text flex-x-y"},co={class:"edit_buttons"},ro={class:"card_tips"},uo={class:"card_title"},po={class:"card_content export_buttons"},_o={__name:"color_card",setup(t){const e=k();ce();const{t:n}=Y(),l=b(null),o=b(null);function i(){for(let g=0;g<25;g++)e.colorList.push({id:g,color:"#000000"})}re(()=>{e.colorList.length===0&&i()});const r=(g,_)=>{e.activeColor=_},p=g=>{const _=e.activeColor;if(g===0){if(_>0){const C=e.colorList.splice(_,1)[0];e.colorList.splice(_-1,0,C),e.activeColor-=1}}else if(_<e.colorList.length-1){const C=e.colorList.splice(_,1)[0];e.colorList.splice(_+1,0,C),e.activeColor+=1}};let c=S(()=>{var g;return(g=e.colorList[e.activeColor])==null?void 0:g.color.toUpperCase()});const u=()=>{e.resultCode=O(),e.resultCode&&(navigator.clipboard?(navigator.clipboard.writeText(e.resultCode),G(n("toast.copy"))):G(n("toast.copy_err")))},h=()=>{e.resultCode=O(),e.resultCode&&o.value.show()},a=()=>{l.value.show()};return(g,_)=>(f(),$("div",to,[s("p",oo,d(g.$t("imageToLabel.color.title_1")),1),s("div",so,[s("div",lo,[(f(!0),$(ee,null,te(m(e).colorList,(C,y)=>(f(),$("div",{key:y,class:K({color_item:!0,active:y==m(e).activeColor}),style:R(`background: ${C.color}`),onClick:I=>r(C,y)},null,14,no))),128))])]),s("div",ao,[s("div",io,[s("span",null,d(m(c)),1)]),s("div",co,[v(D,{type:"default",icon:"left",onClick:_[0]||(_[0]=C=>p(0))}),v(D,{type:"default",icon:"right",onClick:_[1]||(_[1]=C=>p(1))})]),s("div",ro,[s("p",null,d(g.$t("imageToLabel.color.color_tips")),1)])]),s("p",uo,d(g.$t("imageToLabel.color.title_2")),1),s("div",po,[v(D,{type:"primary",text:g.$t("imageToLabel.color.btn_copy"),onClick:u},null,8,["text"]),v(D,{type:"default",text:g.$t("imageToLabel.color.btn_m_copy"),onClick:h},null,8,["text"]),v(D,{type:"default",text:g.$t("imageToLabel.color.btn_help"),onClick:a},null,8,["text"])]),v(J,{ref_key:"howToUsePopupRef",ref:l,title:g.$t("popup_howToUse.main_title")},{default:q(()=>[v(Ot)]),_:1},8,["title"]),v(J,{ref_key:"manualCopyPopupRef",ref:o,title:g.$t("popup_manualCopy.main_title")},{default:q(()=>[v(eo)]),_:1},8,["title"])]))}},mo=w(_o,[["__scopeId","data-v-b1c637e8"]]),ho={class:"imagetolabel-page"},go={class:"container"},fo={__name:"ImageToLabel",setup(t){const e=k(),n=b(null),l=()=>{if(e.imageData==null)return;const o=new Image;o.src=e.imageData,o.onload=function(){const i=he(o);e.newImageData=i.newCanvas}};return ue(()=>{e.reset()}),(o,i)=>(f(),$("div",ho,[v(de,{title:o.$t("imageToLabel.title")},null,8,["title"]),s("div",go,[v(gt,{onChange:l}),v(bt,{ref_key:"result_card",ref:n},null,512),v(mo)])]))}},bo=w(fo,[["__scopeId","data-v-4491cd73"]]);export{bo as default};
