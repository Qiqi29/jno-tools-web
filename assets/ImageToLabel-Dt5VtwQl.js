import{g as Q,_ as x,h as S,o as f,c as v,a as n,n as N,i as y,b as g,t as r,u as p,e as T,j as R,k as G,d as J,l as q,m as Y,p as Z,v as ee,q as te,s as oe,F as se,x as ne,w as B,y as le}from"./index-DLTtk3X1.js";import{t as ae}from"./Topbar-DI2QvXji.js";import{i as U}from"./Icon-C2J9OMDB.js";function E(t){let e=t;typeof t=="string"&&(e=t.split(",").map(s=>parseInt(s,10)));const l=s=>{const o=s.toString(16);return o.length===1?"0"+o:o};return"#"+l(e[0])+l(e[1])+l(e[2])}function ie(t,e,l,s,o){const i=(t-e)/(l-e),c=s+i*(o-s);return Math.min(o,Math.max(s,c))}const z={imageData:null,newImageData:null,resultCode:null,imageWidth:80,colorNum:3,colorDetail:100,colorThreshold:30,transMode:0,transModeList:["关闭","自动","指定颜色"],transColor:0,imageColors:[],activeColor:15,colorList:[]},I=Q("label_date",{state:()=>({...z}),actions:{reset(){Object.assign(this,z),this.colorList=[]}}}),b=I(),ce=["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0A0A0A","#0B0B0B","#0C0C0C","#0D0D0D","#0E0E0E","#0F0F0F","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818"];function re(t,e){const l=document.createElement("canvas"),s=l.getContext("2d",{willReadFrequently:!0}),o=e/t.width*t.height;return l.width=e,l.height=o,s.drawImage(t,0,0,e,o),l}function ue(t){const e=re(t,b.imageWidth),l=e.getContext("2d",{willReadFrequently:!0}),s=l.getImageData(0,0,e.width,e.height),o=s.data,i={};for(let a=0;a<o.length;a+=16){const d=o[a],u=o[a+1],$=o[a+2];if(o[a+3]===0)continue;const D=`${d},${u},${$}`;i[D]?i[D]++:i[D]=1}const c={};Object.keys(i).forEach(a=>{let d=!1;Object.keys(c).forEach(u=>{if(K(k(a),k(u))<b.colorThreshold){c[u]+=i[a],d=!0;return}}),d||(c[a]=i[a])});const h=Object.entries(c).sort((a,d)=>d[1]-a[1]).slice(0,b.colorNum).map(a=>a[0]);b.imageColors=h,pe(h);for(let a=0;a<o.length;a+=4){const d=o[a],u=o[a+1],$=o[a+2],w=o[a+3];if(w===0)continue;const D=`${d},${u},${$}`,M=de(D,h);o[a]=k(M)[0],o[a+1]=k(M)[1],o[a+2]=k(M)[2],o[a+3]=w<b.colorDetail?0:255,b.transMode===2&&M==b.imageColors[b.transColor]&&(o[a+3]=0)}b.transMode===1&&(_e(1,1,[0,0,0,0],e,o),l.putImageData(s,0,0));const m=document.createElement("canvas");return m.width=e.width,m.height=e.height,m.getContext("2d",{willReadFrequently:!0}).putImageData(s,0,0),{newCanvas:m,topColors:h}}function de(t,e){let l=null,s=1/0;const o=k(t);return e.forEach(i=>{const c=k(i),_=K(o,c);_<s&&(s=_,l=i)}),l}function k(t){return t.split(",").map(e=>parseInt(e,10))}function K(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function pe(t){for(let e=0;e<25;e++)b.colorList[e].color="#000000";for(let e=0;e<10;e++)t[e]&&(b.colorList[e+15].color=E(t[e]))}function _e(t,e,l,s,o){const i=P(t,e,s,o);if(i[3]===0)return;const c=[[t,e]];let _;for(;c.length;){if(_=c.pop(),t=_[0],e=_[1],t<0||t>=s.width||e<0||e>=s.height)continue;let h=P(t,e,s,o);if(!me(h,i))continue;let m=(t+e*s.width)*4;o.set(l,m),c.push([t+1,e]),c.push([t-1,e]),c.push([t,e+1]),c.push([t,e-1])}}function P(t,e,l,s){var o=(t+e*l.width)*4;return[s[o],s[o+1],s[o+2],s[o+3]]}function me(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function A(){const t=b.newImageData;if(t==null)return;let e="<mspace=0.2><line-height=0.2><size=0.65>";const o=t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,t.width,t.height).data;let i=null;for(let c=0;c<o.length;c+=4){const _=o[c],h=o[c+1],m=o[c+2],C=o[c+3],a=`${_},${h},${m}`;i===null&&(i=a,C!==0&&(e+=`<${H(a)}>`)),a!==i&&C!==0&&(e+=`<${H(a)}>`,i=a),c/4%t.width===0&&(e+="<br>"),C===255?e+=".":e+=" "}return e=e.replace(/\s*<br>/g,"<br>").trimEnd(),e=e.replace(/\s{12,}/g,c=>`<space=${(c.length*.2).toFixed(1).replace(/\.0$/,"")}>`),e}function H(t){const e=E(t),l=b.colorList.findIndex(o=>o.color===e);return ce[l]}const he={class:"qi-slider"},fe=["min","max","step","value"],ge={__name:"Slider",props:{modelValue:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["update:modelValue","change","touchup"],setup(t,{emit:e}){const l=t,s=e,o=_=>{const h=parseInt(_.target.value,10);s("update:modelValue",h),s("change")},i=_=>{s("touchup")},c=S(()=>ie(l.modelValue,l.min,l.max,0,100));return(_,h)=>(f(),v("div",he,[n("input",{type:"range",min:t.min,max:t.max,step:t.step,value:t.modelValue,style:N(`background-size: ${c.value}% 100%`),onInput:o,onMouseup:i,onTouchend:i},null,44,fe)]))}},F=x(ge,[["__scopeId","data-v-cde83c6a"]]),ve={class:"qi-select flex-x-between"},$e={class:"value_text"},Ce={key:0,class:"text"},be={__name:"Select",props:{modelValue:{type:Number,required:!0},valueList:{type:Array,default:()=>["开启","关闭"]},isColor:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:e}){const l=t,s=e,o=y(l.modelValue),i=c=>{c===0?o.value=o.value<=0?l.valueList.length-1:o.value-1:o.value=o.value>=l.valueList.length-1?0:o.value+1,s("update:modelValue",o.value),s("change")};return(c,_)=>(f(),v("div",ve,[n("div",{class:"button",onClick:_[0]||(_[0]=h=>i(0))},[g(U,{icon:"left",size:"1.5em"})]),n("div",$e,[t.isColor?(f(),v("div",{key:1,class:"color",style:N({backgroundColor:p(E)(t.valueList[t.modelValue])})},null,4)):(f(),v("span",Ce,r(t.valueList[t.modelValue]),1))]),n("div",{class:"button",onClick:_[1]||(_[1]=h=>i(1))},[g(U,{icon:"right",size:"1.5em"})])]))}},j=x(be,[["__scopeId","data-v-36395c5b"]]),xe=["accept"],we={key:0,class:"tipsText flex-y"},ye=["innerHTML"],Te=["src"],Le={key:2,class:"xmlData"},ke={__name:"UploadFile",props:{text:{type:String,default:"点击选择文件，或拖拽到此处"},accept:{type:String,default:"image/*"}},emits:["change"],setup(t,{emit:e}){const l=t,s=e;let o=y(!1),i=y(!1),c=y(""),_=y("");function h(u){const $=u.target.files;d($)}function m(u){u.preventDefault(),i.value=!0}function C(u){u.preventDefault(),i.value=!1}function a(u){u.preventDefault(),i.value=!1;const $=u.dataTransfer.files;d($)}function d(u){if(u.length>0){const $=new FileReader;$.readAsDataURL(u[0]),$.onload=function(w){l.accept==="image/*"&&(c.value=w.target.result),l.accept===".xml"&&(_.value=w.target.result),o.value=!0,s("change",w.target.result)}}}return(u,$)=>(f(),v("label",{onDragover:m,onDragleave:C,onDrop:a},[n("input",{type:"file",accept:t.accept,onChange:h},null,40,xe),n("div",{class:R(["uploadFile flex-x-y",{draging:p(i)}])},[p(o)?T("",!0):(f(),v("div",we,[g(U,{icon:"upload",size:"2em"}),n("div",{class:"text",innerHTML:t.text},null,8,ye)])),p(o)&&t.accept==="image/*"?(f(),v("img",{key:1,src:p(c),alt:""},null,8,Te)):T("",!0),p(o)&&t.accept===".xml"?(f(),v("div",Le,$[0]||($[0]=[n("span",null,"已选择xml文件",-1)]))):T("",!0)],2)],32))}},De=x(ke,[["__scopeId","data-v-f3a59af5"]]),Ie={class:"main_card edit_card"},Ve={class:"card_title"},Ue={class:"card_title"},Se={class:"card_content"},Me={class:"setting_item"},Fe={class:"content flex-x-between"},qe={class:"title"},Ne={class:"value"},Re={class:"card_tips"},Ee={class:"setting_item"},Be={class:"content flex-x-between"},ze={class:"title"},Pe={class:"value"},Ae={class:"setting_item"},He={class:"content flex-x-between"},je={class:"title"},Oe={class:"value"},We={class:"setting_item"},Xe={class:"content flex-x-between"},Ge={class:"title"},Je={class:"value"},Ke={key:0,class:"setting_item"},Qe={class:"content flex-x-between"},Ye={class:"title"},Ze={key:1,class:"setting_item"},et={class:"content flex-x-between"},tt={class:"title"},ot={__name:"edit_card",emits:["change"],setup(t,{emit:e}){const{t:l}=G(),s=I(),o=e,i=y(["imageToLabel.edit.tranMode_off","imageToLabel.edit.tranMode_auto","imageToLabel.edit.tranMode_color"]),c=S(()=>i.value.map(m=>l(m)));function _(m){s.imageData=m,o("change")}const h=()=>{o("change")};return(m,C)=>(f(),v("div",Ie,[n("p",Ve,r(m.$t("imageToLabel.edit.title_1")),1),g(De,{accept:"image/*",onChange:_,text:m.$t("imageToLabel.edit.select_image")},null,8,["text"]),n("p",Ue,r(m.$t("imageToLabel.edit.title_2")),1),n("div",Se,[n("div",Me,[n("div",Fe,[n("p",qe,r(m.$t("imageToLabel.edit.imgw")),1),n("p",Ne,r(p(s).imageWidth),1)]),g(F,{modelValue:p(s).imageWidth,"onUpdate:modelValue":C[0]||(C[0]=a=>p(s).imageWidth=a),onTouchup:h,min:10,max:400,step:10},null,8,["modelValue"])]),n("div",Re,[n("p",null,r(m.$t("imageToLabel.edit.imgw_tips")),1)]),n("div",Ee,[n("div",Be,[n("p",ze,r(m.$t("imageToLabel.edit.colorNum")),1),n("p",Pe,r(p(s).colorNum),1)]),g(F,{modelValue:p(s).colorNum,"onUpdate:modelValue":C[1]||(C[1]=a=>p(s).colorNum=a),onTouchup:h,min:1,max:10},null,8,["modelValue"])]),n("div",Ae,[n("div",He,[n("p",je,r(m.$t("imageToLabel.edit.colorTh")),1),n("p",Oe,r(p(s).colorThreshold),1)]),g(F,{modelValue:p(s).colorThreshold,"onUpdate:modelValue":C[2]||(C[2]=a=>p(s).colorThreshold=a),onTouchup:h,min:10,max:200,step:1},null,8,["modelValue"])]),n("div",We,[n("div",Xe,[n("p",Ge,r(m.$t("imageToLabel.edit.tranValue")),1),n("p",Je,r(p(s).colorDetail),1)]),g(F,{modelValue:p(s).colorDetail,"onUpdate:modelValue":C[3]||(C[3]=a=>p(s).colorDetail=a),onTouchup:h,min:0,max:200,step:1},null,8,["modelValue"])]),p(s).imageColors.length!==0?(f(),v("div",Ke,[n("div",Qe,[n("p",Ye,r(m.$t("imageToLabel.edit.tranMode")),1),g(j,{modelValue:p(s).transMode,"onUpdate:modelValue":C[4]||(C[4]=a=>p(s).transMode=a),onChange:h,"value-list":c.value},null,8,["modelValue","value-list"])])])):T("",!0),p(s).transMode==2?(f(),v("div",Ze,[n("div",et,[n("p",tt,r(m.$t("imageToLabel.edit.tranColor")),1),g(j,{modelValue:p(s).transColor,"onUpdate:modelValue":C[5]||(C[5]=a=>p(s).transColor=a),onChange:h,"value-list":p(s).imageColors,"is-color":!0},null,8,["modelValue","value-list"])])])):T("",!0)])]))}},st=x(ot,[["__scopeId","data-v-cb7a86ba"]]),nt={class:"main_card result_card"},lt={class:"card_title"},at={class:"result_box flex-x-y"},it=["src"],ct={__name:"result_card",setup(t){const e=I(),l=S(()=>{if(e.newImageData!==null)return e.newImageData.toDataURL()}),s=o=>{};return(o,i)=>(f(),v("div",nt,[n("p",lt,r(o.$t("imageToLabel.result.title_1")),1),n("div",at,[l.value?(f(),v("img",{key:0,src:l.value,onClick:s,alt:""},null,8,it)):T("",!0)])]))}},rt=x(ct,[["__scopeId","data-v-01d871a0"]]),ut={class:"qi-toast"},dt={__name:"Toast",props:{message:{type:String,default:"提示文本"},icon:{type:String,default:""}},setup(t){return(e,l)=>(f(),v("div",ut,[t.icon?(f(),J(U,{key:0,icon:t.icon},null,8,["icon"])):T("",!0),n("span",null,r(t.message),1)]))}},pt=x(dt,[["__scopeId","data-v-48078998"]]);let O=null,L=null;function W(t,e=1500){L=document.querySelector(".toast-container"),L?q(null,L):(L=document.createElement("div"),L.setAttribute("class","toast-container"),document.querySelector("body").appendChild(L));const l=g(pt,{message:t});q(l,L),clearTimeout(O),O=setTimeout(()=>{q(null,L)},e)}const _t={key:1},mt={__name:"Button",props:{text:{type:String,default:""},type:{type:String,default:"default"},icon:{type:String,default:""}},emits:["click"],setup(t,{emit:e}){const l=t,s=S(()=>[`qi-button__${l.type}`]),o=e,i=c=>{o("click")};return(c,_)=>(f(),v("div",{class:R(["qi-button flex-x-y",s.value]),onClick:i},[t.icon?(f(),J(U,{key:0,icon:t.icon,size:"1.3em"},null,8,["icon"])):T("",!0),t.text?(f(),v("span",_t,r(t.text),1)):T("",!0)],2))}},V=x(mt,[["__scopeId","data-v-27ac9df2"]]),ht={key:0,class:"popup-box"},ft={class:"popup"},gt={class:"top_box flex-x-y"},vt={class:"title"},$t={class:"content"},Ct={__name:"Popup",props:{title:{type:String,default:"弹窗标题"}},setup(t,{expose:e}){const l=y(!1);function s(){l.value=!0}function o(){l.value=!1}return e({show:s}),(i,c)=>l.value?(f(),v("div",ht,[n("div",ft,[n("div",gt,[n("p",vt,r(t.title),1),n("div",{class:"close_button flex-x-y",onClick:o},"X")]),n("div",$t,[Y(i.$slots,"default",{},void 0)])])])):T("",!0)}},X=x(Ct,[["__scopeId","data-v-98f2569b"]]),bt={},xt={class:"content"},wt={class:"popup_title"},yt={class:"popup_text"},Tt={class:"popup_title"},Lt={class:"popup_text"},kt={class:"popup_text"},Dt={class:"popup_text"},It={class:"popup_text"},Vt={class:"popup_title"},Ut={class:"popup_text"},St={class:"popup_title"},Mt={class:"popup_text"},Ft={class:"popup_text"};function qt(t,e){return f(),v("div",xt,[n("p",wt,r(t.$t("popup_howToUse.title_1")),1),n("p",yt,r(t.$t("popup_howToUse.text_1")),1),n("p",Tt,r(t.$t("popup_howToUse.title_2")),1),n("p",Lt,r(t.$t("popup_howToUse.text_2")),1),n("p",kt,r(t.$t("popup_howToUse.text_3")),1),n("p",Dt,r(t.$t("popup_howToUse.text_4")),1),n("p",It,r(t.$t("popup_howToUse.text_5")),1),n("p",Vt,r(t.$t("popup_howToUse.title_3")),1),n("p",Ut,r(t.$t("popup_howToUse.text_6")),1),n("p",St,r(t.$t("popup_howToUse.title_4")),1),n("p",Mt,r(t.$t("popup_howToUse.text_7")),1),n("p",Ft,r(t.$t("popup_howToUse.text_8")),1)])}const Nt=x(bt,[["render",qt]]),Rt={class:"content"},Et={__name:"manualCopy",setup(t){const e=I();return(l,s)=>(f(),v("div",Rt,[Z(n("textarea",{"onUpdate:modelValue":s[0]||(s[0]=o=>p(e).resultCode=o)},null,512),[[ee,p(e).resultCode]])]))}},Bt=x(Et,[["__scopeId","data-v-d253e806"]]),zt={class:"main_card color_card"},Pt={class:"card_title"},At={class:"color_box flex-y"},Ht={class:"color_list"},jt=["onClick"],Ot={class:"card_content"},Wt={class:"color_hex_text flex-x-y"},Xt={class:"edit_buttons"},Gt={class:"card_tips"},Jt={class:"card_title"},Kt={class:"card_content export_buttons"},Qt={__name:"color_card",setup(t){const e=I();te();const{t:l}=G(),s=y(null),o=y(null);function i(){for(let d=0;d<25;d++)e.colorList.push({id:d,color:"#000000"})}oe(()=>{e.colorList.length===0&&i()});const c=(d,u)=>{e.activeColor=u},_=d=>{const u=e.activeColor;if(d===0){if(u>0){const $=e.colorList.splice(u,1)[0];e.colorList.splice(u-1,0,$),e.activeColor-=1}}else if(u<e.colorList.length-1){const $=e.colorList.splice(u,1)[0];e.colorList.splice(u+1,0,$),e.activeColor+=1}};let h=S(()=>{var d;return(d=e.colorList[e.activeColor])==null?void 0:d.color.toUpperCase()});const m=()=>{e.resultCode=A(),e.resultCode&&(navigator.clipboard?(navigator.clipboard.writeText(e.resultCode),W(l("toast.copy"))):W(l("toast.copy_err")))},C=()=>{e.resultCode=A(),e.resultCode&&o.value.show()},a=()=>{s.value.show()};return(d,u)=>(f(),v("div",zt,[n("p",Pt,r(d.$t("imageToLabel.color.title_1")),1),n("div",At,[n("div",Ht,[(f(!0),v(se,null,ne(p(e).colorList,($,w)=>(f(),v("div",{key:w,class:R({color_item:!0,active:w==p(e).activeColor}),style:N(`background: ${$.color}`),onClick:D=>c($,w)},null,14,jt))),128))])]),n("div",Ot,[n("div",Wt,[n("span",null,r(p(h)),1)]),n("div",Xt,[g(V,{type:"default",icon:"left",onClick:u[0]||(u[0]=$=>_(0))}),g(V,{type:"default",icon:"right",onClick:u[1]||(u[1]=$=>_(1))})]),n("div",Gt,[n("p",null,r(d.$t("imageToLabel.color.color_tips")),1)])]),n("p",Jt,r(d.$t("imageToLabel.color.title_2")),1),n("div",Kt,[g(V,{type:"primary",text:d.$t("imageToLabel.color.btn_copy"),onClick:m},null,8,["text"]),g(V,{type:"default",text:d.$t("imageToLabel.color.btn_m_copy"),onClick:C},null,8,["text"]),g(V,{type:"default",text:d.$t("imageToLabel.color.btn_help"),onClick:a},null,8,["text"])]),g(X,{ref_key:"howToUsePopupRef",ref:s,title:d.$t("popup_howToUse.main_title")},{default:B(()=>[g(Nt)]),_:1},8,["title"]),g(X,{ref_key:"manualCopyPopupRef",ref:o,title:d.$t("popup_manualCopy.main_title")},{default:B(()=>[g(Bt)]),_:1},8,["title"])]))}},Yt=x(Qt,[["__scopeId","data-v-b1c637e8"]]),Zt={class:"imagetolabel-page"},eo={class:"container"},to={__name:"ImageToLabel",setup(t){const e=I(),l=y(null),s=()=>{if(e.imageData==null)return;const o=new Image;o.src=e.imageData,o.onload=function(){const i=ue(o);e.newImageData=i.newCanvas}};return le(()=>{e.reset()}),(o,i)=>(f(),v("div",Zt,[g(ae,{title:o.$t("imageToLabel.title")},null,8,["title"]),n("div",eo,[g(st,{onChange:s}),g(rt,{ref_key:"result_card",ref:l},null,512),g(Yt)])]))}},lo=x(to,[["__scopeId","data-v-4491cd73"]]);export{lo as default};
