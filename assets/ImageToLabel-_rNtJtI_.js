import{g as st,_ as w,h as D,o as g,c as $,a as s,n as B,i as b,b as v,t as d,u as h,e as T,j as E,k as Z,d as z,l as R,w as q,m as N,T as P,p as lt,q as nt,v as H,s as at,x as j,F as tt,y as et,z as it,A as ct,B as rt}from"./index-CoHW37Vb.js";import{t as ut}from"./Topbar-DXFOwf65.js";import{i as S}from"./Icon-KR104nX5.js";function A(e){let t=e;typeof e=="string"&&(t=e.split(",").map(l=>parseInt(l,10)));const n=l=>{const o=l.toString(16);return o.length===1?"0"+o:o};return"#"+n(t[0])+n(t[1])+n(t[2])}function dt(e,t,n,l,o){const i=(e-t)/(n-t),c=l+i*(o-l);return Math.min(o,Math.max(l,c))}const O={imageData:null,newImageData:null,resultCode:null,imageWidth:150,colorNum:3,colorDetail:100,colorThreshold:30,transMode:0,transModeList:["关闭","自动","指定颜色"],transColor:0,imageColors:[],activeColor:15,colorList:[]},V=st("label_date",{state:()=>({...O}),actions:{reset(){Object.assign(this,O),this.colorList=[]}}}),x=V(),pt=["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0A0A0A","#0B0B0B","#0C0C0C","#0D0D0D","#0E0E0E","#0F0F0F","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818"];function _t(e,t){const n=document.createElement("canvas"),l=n.getContext("2d",{willReadFrequently:!0}),o=t/e.width*e.height;return n.width=t,n.height=o,l.drawImage(e,0,0,t,o),n}function mt(e){const t=_t(e,x.imageWidth),n=t.getContext("2d",{willReadFrequently:!0}),l=n.getImageData(0,0,t.width,t.height),o=l.data,i={};for(let a=0;a<o.length;a+=16){const m=o[a],p=o[a+1],C=o[a+2];if(o[a+3]===0)continue;const I=`${m},${p},${C}`;i[I]?i[I]++:i[I]=1}const c={};Object.keys(i).forEach(a=>{let m=!1;Object.keys(c).forEach(p=>{if(ot(k(a),k(p))<x.colorThreshold){c[p]+=i[a],m=!0;return}}),m||(c[a]=i[a])});const r=Object.entries(c).sort((a,m)=>m[1]-a[1]).slice(0,x.colorNum).map(a=>a[0]);x.imageColors=r,ft(r);for(let a=0;a<o.length;a+=4){const m=o[a],p=o[a+1],C=o[a+2],y=o[a+3];if(y===0)continue;const I=`${m},${p},${C}`,M=ht(I,r);o[a]=k(M)[0],o[a+1]=k(M)[1],o[a+2]=k(M)[2],o[a+3]=y<x.colorDetail?0:255,x.transMode===2&&M==x.imageColors[x.transColor]&&(o[a+3]=0)}x.transMode===1&&(gt(1,1,[0,0,0,0],t,o),n.putImageData(l,0,0));const u=document.createElement("canvas");return u.width=t.width,u.height=t.height,u.getContext("2d",{willReadFrequently:!0}).putImageData(l,0,0),{newCanvas:u,topColors:r}}function ht(e,t){let n=null,l=1/0;const o=k(e);return t.forEach(i=>{const c=k(i),_=ot(o,c);_<l&&(l=_,n=i)}),n}function k(e){return e.split(",").map(t=>parseInt(t,10))}function ot(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function ft(e){for(let t=0;t<25;t++)x.colorList[t].color="#000000";for(let t=0;t<10;t++)e[t]&&(x.colorList[t+15].color=A(e[t]))}function gt(e,t,n,l,o){const i=W(e,t,l,o);if(i[3]===0)return;const c=[[e,t]];let _;for(;c.length;){if(_=c.pop(),e=_[0],t=_[1],e<0||e>=l.width||t<0||t>=l.height)continue;let r=W(e,t,l,o);if(!vt(r,i))continue;let u=(e+t*l.width)*4;o.set(n,u),c.push([e+1,t]),c.push([e-1,t]),c.push([e,t+1]),c.push([e,t-1])}}function W(e,t,n,l){var o=(e+t*n.width)*4;return[l[o],l[o+1],l[o+2],l[o+3]]}function vt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function X(){const e=x.newImageData;if(e==null)return;let t="<mspace=0.2><line-height=0.2><size=0.65>";const o=e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e.width,e.height).data;let i=null;for(let c=0;c<o.length;c+=4){const _=o[c],r=o[c+1],u=o[c+2],f=o[c+3],a=`${_},${r},${u}`;i===null&&(i=a,f!==0&&(t+=`<${G(a)}>`)),a!==i&&f!==0&&(t+=`<${G(a)}>`,i=a),c/4%e.width===0&&(t+="<br>"),f===255?t+=".":t+=" "}return t=t.replace(/\s*<br>/g,"<br>").trimEnd(),t=t.replace(/\s{12,}/g,c=>`<space=${(c.length*.2).toFixed(1).replace(/\.0$/,"")}>`),t}function G(e){const t=A(e),n=x.colorList.findIndex(o=>o.color===t);return pt[n]}const $t={class:"qi-slider"},Ct=["min","max","step","value"],xt={__name:"Slider",props:{modelValue:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["update:modelValue","change","touchup"],setup(e,{emit:t}){const n=e,l=t,o=_=>{const r=parseInt(_.target.value,10);l("update:modelValue",r),l("change")},i=_=>{l("touchup")},c=D(()=>dt(n.modelValue,n.min,n.max,0,100));return(_,r)=>(g(),$("div",$t,[s("input",{type:"range",min:e.min,max:e.max,step:e.step,value:e.modelValue,style:B(`background-size: ${c.value}% 100%`),onInput:o,onMouseup:i,onTouchend:i},null,44,Ct)]))}},F=w(xt,[["__scopeId","data-v-1103b91c"]]),bt={class:"qi-select flex-x-between"},wt={class:"value_text"},yt={key:0,class:"text"},Tt={__name:"Select",props:{modelValue:{type:Number,required:!0},valueList:{type:Array,default:()=>["开启","关闭"]},isColor:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,l=t,o=b(n.modelValue),i=c=>{c===0?o.value=o.value<=0?n.valueList.length-1:o.value-1:o.value=o.value>=n.valueList.length-1?0:o.value+1,l("update:modelValue",o.value),l("change")};return(c,_)=>(g(),$("div",bt,[s("div",{class:"button flex-x-y",onClick:_[0]||(_[0]=r=>i(0))},[v(S,{icon:"left",size:"1.4em"})]),s("div",wt,[e.isColor?(g(),$("div",{key:1,class:"color",style:B({backgroundColor:h(A)(e.valueList[e.modelValue])})},null,4)):(g(),$("span",yt,d(e.valueList[e.modelValue]),1))]),s("div",{class:"button flex-x-y",onClick:_[1]||(_[1]=r=>i(1))},[v(S,{icon:"right",size:"1.4em"})])]))}},J=w(Tt,[["__scopeId","data-v-b16e0a64"]]),Lt=["accept"],kt={key:0,class:"tipsText flex-y"},It=["innerHTML"],Dt=["src"],Vt={key:2,class:"xmlData"},Ut={__name:"UploadFile",props:{text:{type:String,default:"点击选择文件，或拖拽到此处"},accept:{type:String,default:"image/*"}},emits:["change"],setup(e,{emit:t}){const n=e,l=t;let o=b(!1),i=b(!1),c=b(""),_=b("");function r(p){const C=p.target.files;m(C)}function u(p){p.preventDefault(),i.value=!0}function f(p){p.preventDefault(),i.value=!1}function a(p){p.preventDefault(),i.value=!1;const C=p.dataTransfer.files;m(C)}function m(p){if(p.length>0){const C=new FileReader;C.readAsDataURL(p[0]),C.onload=function(y){n.accept==="image/*"&&(c.value=y.target.result),n.accept===".xml"&&(_.value=y.target.result),o.value=!0,l("change",y.target.result)}}}return(p,C)=>(g(),$("label",{onDragover:u,onDragleave:f,onDrop:a},[s("input",{type:"file",accept:e.accept,onChange:r},null,40,Lt),s("div",{class:E(["uploadFile flex-x-y",{draging:h(i)}])},[h(o)?T("",!0):(g(),$("div",kt,[v(S,{icon:"upload",size:"2em"}),s("div",{class:"text",innerHTML:e.text},null,8,It)])),h(o)&&e.accept==="image/*"?(g(),$("img",{key:1,src:h(c),alt:""},null,8,Dt)):T("",!0),h(o)&&e.accept===".xml"?(g(),$("div",Vt,C[0]||(C[0]=[s("span",null,"已选择xml文件",-1)]))):T("",!0)],2)],32))}},St=w(Ut,[["__scopeId","data-v-f3a59af5"]]),Mt={class:"main_card edit_card"},Ft={class:"card_title"},qt={class:"card_title"},Nt={class:"card_content"},Rt={class:"setting_item"},Bt={class:"content flex-x-between"},Et={class:"title"},zt={class:"value"},At={class:"card_tips"},Pt={class:"setting_item"},Ht={class:"content flex-x-between"},jt={class:"title"},Ot={class:"value"},Wt={class:"setting_item"},Xt={class:"content flex-x-between"},Gt={class:"title"},Jt={class:"value"},Kt={class:"setting_item"},Qt={class:"content flex-x-between"},Yt={class:"title"},Zt={class:"value"},te={key:0,class:"setting_item"},ee={class:"content flex-x-between"},oe={class:"title"},se={key:1,class:"setting_item"},le={class:"content flex-x-between"},ne={class:"title"},ae={__name:"edit_card",emits:["change"],setup(e,{emit:t}){const{t:n}=Z(),l=V(),o=t,i=b(["imageToLabel.edit.tranMode_off","imageToLabel.edit.tranMode_auto","imageToLabel.edit.tranMode_color"]),c=D(()=>i.value.map(u=>n(u)));function _(u){l.imageData=u,o("change")}const r=()=>{o("change")};return(u,f)=>(g(),$("div",Mt,[s("p",Ft,d(u.$t("imageToLabel.edit.title_1")),1),v(St,{accept:"image/*",onChange:_,text:u.$t("imageToLabel.edit.select_image")},null,8,["text"]),s("p",qt,d(u.$t("imageToLabel.edit.title_2")),1),s("div",Nt,[s("div",Rt,[s("div",Bt,[s("p",Et,d(u.$t("imageToLabel.edit.imgw")),1),s("p",zt,d(h(l).imageWidth),1)]),v(F,{modelValue:h(l).imageWidth,"onUpdate:modelValue":f[0]||(f[0]=a=>h(l).imageWidth=a),onTouchup:r,min:10,max:400,step:10},null,8,["modelValue"])]),s("div",At,[s("p",null,d(u.$t("imageToLabel.edit.imgw_tips")),1)]),s("div",Pt,[s("div",Ht,[s("p",jt,d(u.$t("imageToLabel.edit.colorNum")),1),s("p",Ot,d(h(l).colorNum),1)]),v(F,{modelValue:h(l).colorNum,"onUpdate:modelValue":f[1]||(f[1]=a=>h(l).colorNum=a),onTouchup:r,min:1,max:10},null,8,["modelValue"])]),s("div",Wt,[s("div",Xt,[s("p",Gt,d(u.$t("imageToLabel.edit.colorTh")),1),s("p",Jt,d(h(l).colorThreshold),1)]),v(F,{modelValue:h(l).colorThreshold,"onUpdate:modelValue":f[2]||(f[2]=a=>h(l).colorThreshold=a),onTouchup:r,min:10,max:200,step:1},null,8,["modelValue"])]),s("div",Kt,[s("div",Qt,[s("p",Yt,d(u.$t("imageToLabel.edit.tranValue")),1),s("p",Zt,d(h(l).colorDetail),1)]),v(F,{modelValue:h(l).colorDetail,"onUpdate:modelValue":f[3]||(f[3]=a=>h(l).colorDetail=a),onTouchup:r,min:0,max:200,step:1},null,8,["modelValue"])]),h(l).imageColors.length!==0?(g(),$("div",te,[s("div",ee,[s("p",oe,d(u.$t("imageToLabel.edit.tranMode")),1),v(J,{modelValue:h(l).transMode,"onUpdate:modelValue":f[4]||(f[4]=a=>h(l).transMode=a),onChange:r,"value-list":c.value},null,8,["modelValue","value-list"])])])):T("",!0),h(l).transMode==2?(g(),$("div",se,[s("div",le,[s("p",ne,d(u.$t("imageToLabel.edit.tranColor")),1),v(J,{modelValue:h(l).transColor,"onUpdate:modelValue":f[5]||(f[5]=a=>h(l).transColor=a),onChange:r,"value-list":h(l).imageColors,"is-color":!0},null,8,["modelValue","value-list"])])])):T("",!0)])]))}},ie=w(ae,[["__scopeId","data-v-cb7a86ba"]]),ce={class:"main_card result_card"},re={class:"card_title"},ue={class:"result_box flex-x-y"},de=["src"],pe={__name:"result_card",setup(e){const t=V(),n=D(()=>{if(t.newImageData!==null)return t.newImageData.toDataURL()}),l=o=>{};return(o,i)=>(g(),$("div",ce,[s("p",re,d(o.$t("imageToLabel.result.title_1")),1),s("div",ue,[n.value?(g(),$("img",{key:0,src:n.value,onClick:l,alt:""},null,8,de)):T("",!0)])]))}},_e=w(pe,[["__scopeId","data-v-01d871a0"]]),me={class:"qi-toast"},he={__name:"Toast",props:{message:{type:String,default:"提示文本"},icon:{type:String,default:""}},setup(e){return(t,n)=>(g(),$("div",me,[e.icon?(g(),z(S,{key:0,icon:e.icon},null,8,["icon"])):T("",!0),s("span",null,d(e.message),1)]))}},fe=w(he,[["__scopeId","data-v-48078998"]]);let K=null,L=null;function Q(e,t=1500){L=document.querySelector(".toast-container"),L?R(null,L):(L=document.createElement("div"),L.setAttribute("class","toast-container"),document.querySelector("body").appendChild(L));const n=v(fe,{message:e});R(n,L),clearTimeout(K),K=setTimeout(()=>{R(null,L)},t)}const ge={key:1},ve={__name:"Button",props:{text:{type:String,default:""},type:{type:String,default:"default"},icon:{type:String,default:""}},emits:["click"],setup(e,{emit:t}){const n=e,l=D(()=>[`qi-button__${n.type}`]),o=t,i=c=>{o("click")};return(c,_)=>(g(),$("div",{class:E(["qi-button flex-x-y",l.value]),onClick:i},[e.icon?(g(),z(S,{key:0,icon:e.icon,size:"1.3em"},null,8,["icon"])):T("",!0),e.text?(g(),$("span",ge,d(e.text),1)):T("",!0)],2))}},U=w(ve,[["__scopeId","data-v-27ac9df2"]]),$e={class:"top_box flex-x-y"},Ce={class:"title"},xe={class:"content"},be={__name:"Popup",props:{title:{type:String,default:"弹窗标题"}},setup(e,{expose:t}){const n=b(!1);b(!1);function l(){n.value=!0}function o(){n.value=!1}return t({show:l}),(i,c)=>(g(),z(P,{name:"fade-bg"},{default:q(()=>[N(s("div",{class:"popup-bg",onClick:o},[v(P,{name:"fade-popup"},{default:q(()=>[N(s("div",{class:"popup",onClick:c[0]||(c[0]=lt(()=>{},["stop"]))},[s("div",$e,[s("p",Ce,d(e.title),1),s("div",{class:"close_button flex-x-y",onClick:o},"X")]),s("div",xe,[nt(i.$slots,"default",{},void 0,!0)])],512),[[H,n.value]])]),_:3})],512),[[H,n.value]])]),_:3}))}},Y=w(be,[["__scopeId","data-v-ec449a0a"]]),we={},ye={class:"content"},Te={class:"popup_title"},Le={class:"popup_text"},ke={class:"popup_title"},Ie={class:"popup_text"},De={class:"popup_text"},Ve={class:"popup_text"},Ue={class:"popup_text"},Se={class:"popup_title"},Me={class:"popup_text"},Fe={class:"popup_title"},qe={class:"popup_text"},Ne={class:"popup_text"};function Re(e,t){return g(),$("div",ye,[s("p",Te,d(e.$t("popup_howToUse.title_1")),1),s("p",Le,d(e.$t("popup_howToUse.text_1")),1),s("p",ke,d(e.$t("popup_howToUse.title_2")),1),s("p",Ie,d(e.$t("popup_howToUse.text_2")),1),s("p",De,d(e.$t("popup_howToUse.text_3")),1),s("p",Ve,d(e.$t("popup_howToUse.text_4")),1),s("p",Ue,d(e.$t("popup_howToUse.text_5")),1),s("p",Se,d(e.$t("popup_howToUse.title_3")),1),s("p",Me,d(e.$t("popup_howToUse.text_6")),1),s("p",Fe,d(e.$t("popup_howToUse.title_4")),1),s("p",qe,d(e.$t("popup_howToUse.text_7")),1),s("p",Ne,d(e.$t("popup_howToUse.text_8")),1)])}const Be=w(we,[["render",Re]]),Ee={class:"content"},ze={class:"input_box flex-x"},Ae={class:"text_conut text_show flex-x-y"},Pe={key:0},He={class:"input_list"},je={class:"input_num text_show flex-x-y"},Oe=["value"],We={__name:"manualCopy",setup(e){const t=V(),n=b(""),l=b([]);at(()=>t.resultCode,()=>{n.value="",l.value=[]});const o=D(()=>n.value.length),i=()=>{l.value=c(t.resultCode,o.value)};function c(_,r){const u=[];let f=0;for(;f<_.length;){const a=f+r;u.push(_.substring(f,a)),f=a}return u}return(_,r)=>(g(),$("div",Ee,[r[4]||(r[4]=s("p",{class:"popup_title"},"完整代码",-1)),N(s("textarea",{"onUpdate:modelValue":r[0]||(r[0]=u=>h(t).resultCode=u)},null,512),[[j,h(t).resultCode]]),r[5]||(r[5]=s("p",{class:"popup_title"},"手机剪切板有限制？",-1)),r[6]||(r[6]=s("p",{class:"popup_text"},"把上面的代码复制后粘贴到输入框内↓",-1)),s("div",ze,[N(s("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=u=>n.value=u),onInput:i},null,544),[[j,n.value]]),s("div",Ae,d(o.value),1)]),l.value.length!==0?(g(),$("div",Pe,[r[2]||(r[2]=s("p",{class:"popup_title"},"分段复制",-1)),r[3]||(r[3]=s("p",{class:"popup_text"},"请按顺序复制到 Label 零件中。",-1)),s("div",He,[(g(!0),$(tt,null,et(l.value,(u,f)=>(g(),$("div",{class:"input_box flex-x",key:f},[s("div",je,d(f+1),1),s("input",{type:"text",value:u},null,8,Oe)]))),128))])])):T("",!0)]))}},Xe=w(We,[["__scopeId","data-v-adc376cf"]]),Ge={class:"main_card color_card"},Je={class:"card_title"},Ke={class:"color_box flex-y"},Qe={class:"color_list"},Ye=["onClick"],Ze={class:"card_content"},to={class:"color_hex_text flex-x-y"},eo={class:"edit_buttons"},oo={class:"card_tips"},so={class:"card_title"},lo={class:"card_content export_buttons"},no={__name:"color_card",setup(e){const t=V();it();const{t:n}=Z(),l=b(null),o=b(null);function i(){for(let m=0;m<25;m++)t.colorList.push({id:m,color:"#000000"})}ct(()=>{t.colorList.length===0&&i()});const c=(m,p)=>{t.activeColor=p},_=m=>{const p=t.activeColor;if(m===0){if(p>0){const C=t.colorList.splice(p,1)[0];t.colorList.splice(p-1,0,C),t.activeColor-=1}}else if(p<t.colorList.length-1){const C=t.colorList.splice(p,1)[0];t.colorList.splice(p+1,0,C),t.activeColor+=1}};let r=D(()=>{var m;return(m=t.colorList[t.activeColor])==null?void 0:m.color.toUpperCase()});const u=()=>{t.resultCode=X(),t.resultCode&&(navigator.clipboard?(navigator.clipboard.writeText(t.resultCode),Q(n("toast.copy"))):Q(n("toast.copy_err")))},f=()=>{t.resultCode=X(),t.resultCode&&o.value.show()},a=()=>{l.value.show()};return(m,p)=>(g(),$("div",Ge,[s("p",Je,d(m.$t("imageToLabel.color.title_1")),1),s("div",Ke,[s("div",Qe,[(g(!0),$(tt,null,et(h(t).colorList,(C,y)=>(g(),$("div",{key:y,class:E({color_item:!0,active:y==h(t).activeColor}),style:B(`background: ${C.color}`),onClick:I=>c(C,y)},null,14,Ye))),128))])]),s("div",Ze,[s("div",to,[s("span",null,d(h(r)),1)]),s("div",eo,[v(U,{type:"default",icon:"left",onClick:p[0]||(p[0]=C=>_(0))}),v(U,{type:"default",icon:"right",onClick:p[1]||(p[1]=C=>_(1))})]),s("div",oo,[s("p",null,d(m.$t("imageToLabel.color.color_tips")),1)])]),s("p",so,d(m.$t("imageToLabel.color.title_2")),1),s("div",lo,[v(U,{type:"primary",text:m.$t("imageToLabel.color.btn_copy"),onClick:u},null,8,["text"]),v(U,{type:"default",text:m.$t("imageToLabel.color.btn_m_copy"),onClick:f},null,8,["text"]),v(U,{type:"default",text:m.$t("imageToLabel.color.btn_help"),onClick:a},null,8,["text"])]),v(Y,{ref_key:"howToUsePopupRef",ref:l,title:m.$t("popup_howToUse.main_title")},{default:q(()=>[v(Be)]),_:1},8,["title"]),v(Y,{ref_key:"manualCopyPopupRef",ref:o,title:m.$t("popup_manualCopy.main_title")},{default:q(()=>[v(Xe)]),_:1},8,["title"])]))}},ao=w(no,[["__scopeId","data-v-b1c637e8"]]),io={class:"imagetolabel-page"},co={class:"container"},ro={__name:"ImageToLabel",setup(e){const t=V(),n=b(null),l=()=>{if(t.imageData==null)return;const o=new Image;o.src=t.imageData,o.onload=function(){const i=mt(o);t.newImageData=i.newCanvas}};return rt(()=>{t.reset()}),(o,i)=>(g(),$("div",io,[v(ut,{title:o.$t("imageToLabel.title")},null,8,["title"]),s("div",co,[v(ie,{onChange:l}),v(_e,{ref_key:"result_card",ref:n},null,512),v(ao)])]))}},mo=w(ro,[["__scopeId","data-v-4491cd73"]]);export{mo as default};
